{"version":3,"file":"Watermark.js","sources":["../../../common/js/watermark/generateBase64Url.ts","../../../common/js/watermark/randomMovingStyle.ts","../../../common/js/utils/injectStyle.ts","../../../components/watermark/Watermark.tsx"],"sourcesContent":["import { WatermarkText, WatermarkImage } from './type';\n\nexport default function generateBase64Url({\n  width,\n  height,\n  gapX,\n  gapY,\n  offsetLeft,\n  offsetTop,\n  rotate,\n  alpha,\n  watermarkContent,\n  lineSpace\n}: {\n  width: number,\n  height: number,\n  gapX:number,\n  gapY: number,\n  offsetLeft:number,\n  offsetTop:number,\n  rotate:number,\n  alpha:number,\n  watermarkContent: WatermarkText | WatermarkImage | Array<WatermarkText | WatermarkImage>,\n  lineSpace:number\n}, onFinish: (url: string) => void): string {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  if (!ctx) {\n    // eslint-disable-next-line no-console\n    console.warn('当前环境不支持Canvas, 无法绘制水印');\n    onFinish('');\n    return;\n  }\n  const ratio = window.devicePixelRatio || 1;\n  const canvasWidth = (gapX + width) * ratio;\n  const canvasHeight = (gapY + height) * ratio;\n\n  canvas.width = canvasWidth;\n  canvas.height = canvasHeight;\n  canvas.style.width = `${gapX + width}px`;\n  canvas.style.height = `${gapY + height}px`;\n\n  ctx.translate(offsetLeft * ratio, offsetTop * ratio);\n  ctx.rotate((Math.PI / 180) * Number(rotate));\n  ctx.globalAlpha = alpha;\n\n  const markWidth = width * ratio;\n  const markHeight = height * ratio;\n\n  ctx.fillStyle = 'transparent';\n  ctx.fillRect(0, 0, markWidth, markHeight);\n\n  const contents = Array.isArray(watermarkContent) ? watermarkContent : [{ ...watermarkContent }];\n  let top = 0;\n  contents.forEach((item: WatermarkText & WatermarkImage & { top: number }) => {\n    if (item.url) {\n      const { url, isGrayscale = false } = item;\n      // eslint-disable-next-line no-param-reassign\n      item.top = top;\n      top += height;\n      const img = new Image();\n      img.crossOrigin = 'anonymous';\n      img.referrerPolicy = 'no-referrer';\n      img.src = url;\n      img.onload = () => {\n        // ctx.filter = 'grayscale(1)';\n        ctx.drawImage(img, 0, item.top * ratio, width * ratio, height * ratio);\n        if (isGrayscale) {\n          const imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);\n          const pixels = imgData.data;\n          for (let i = 0; i < pixels.length; i += 4) {\n            const lightness = (pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3;\n            pixels[i] = lightness;\n            pixels[i + 1] = lightness;\n            pixels[i + 2] = lightness;\n          }\n          ctx.putImageData(imgData, 0, 0);\n        }\n        onFinish(canvas.toDataURL());\n      };\n    } else if (item.text) {\n      const {\n        text,\n        fontColor = 'rgba(0, 0, 0, 0.1)',\n        fontSize = 16,\n        fontFamily = undefined,\n        fontWeight = 'normal',\n      } = item;\n      // eslint-disable-next-line no-param-reassign\n      item.top = top;\n      top += lineSpace;\n      const markSize = Number(fontSize) * ratio;\n      // TODO 后续完善font 渲染控制 目前font-family 暂时为 undefined\n      ctx.font = `normal normal ${fontWeight} ${markSize}px/${markHeight}px ${fontFamily}`;\n      ctx.textAlign = 'start';\n      ctx.textBaseline = 'top';\n      ctx.fillStyle = fontColor;\n      ctx.fillText(text, 0, item.top * ratio);\n    }\n  });\n  onFinish(canvas.toDataURL());\n}\n","/* eslint-disable no-nested-ternary */\nexport default function randomMovingStyle() {\n  const align = Math.floor(Math.random() * 4);\n  const p1 = Math.floor(Math.random() * 70) + 30;\n  const leftTopLimit = 0;\n  const bottomLimit = 95;\n  const rightLimit = 90;\n  const keyframesStyle = `\n  @keyframes watermark {\n    0%   {left: ${align === 1 ? rightLimit : align === 3 ? leftTopLimit : p1}%; top: ${\n  align === 0 ? leftTopLimit : align === 2 ? bottomLimit : p1\n}%;}\n    25% {left: ${align === 0 ? rightLimit : align === 2 ? leftTopLimit : 100 - p1}%; top: ${\n  align === 1 ? bottomLimit : align === 3 ? leftTopLimit : p1\n}%;}\n    50% {left: ${align === 1 ? leftTopLimit : align === 3 ? rightLimit : 100 - p1}%; top: ${\n  align === 0 ? bottomLimit : align === 2 ? leftTopLimit : 100 - p1\n}%; transform: translateX(-100%);}\n    75% {left: ${align === 0 ? leftTopLimit : align === 2 ? rightLimit : p1}%; top: ${\n  align === 1 ? leftTopLimit : align === 3 ? bottomLimit : 100 - p1\n}%;}\n    100% {left: ${align === 1 ? rightLimit : align === 3 ? leftTopLimit : p1}%; top: ${\n  align === 0 ? leftTopLimit : align === 2 ? bottomLimit : p1\n}%;}\n  }\n  `;\n  return keyframesStyle;\n}\n","const injectStyle = (style: string) => {\n  const styleElement = document.createElement('style');\n  let styleSheet = null;\n  document.head.appendChild(styleElement);\n  styleSheet = styleElement.sheet;\n  styleSheet.insertRule(style, styleSheet.cssRules.length);\n};\n\nexport default injectStyle;\n","/* eslint-disable no-nested-ternary */\nimport React, { useCallback, useState, useEffect, useRef } from 'react';\nimport classNames from 'classnames';\nimport generateBase64Url from '@tdesign/common-js/watermark/generateBase64Url';\nimport randomMovingStyle from '@tdesign/common-js/watermark/randomMovingStyle';\nimport injectStyle from '@tdesign/common-js/utils/injectStyle';\nimport { StyledProps } from '../common';\nimport useConfig from '../hooks/useConfig';\nimport useMutationObserver from '../hooks/useMutationObserver';\nimport { TdWatermarkProps } from './type';\nimport { watermarkDefaultProps } from './defaultProps';\nimport { getStyleStr } from './utils';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport interface WatermarkProps extends TdWatermarkProps, StyledProps {}\n\nconst Watermark: React.FC<WatermarkProps> = (originalProps) => {\n  const props = useDefaultProps<WatermarkProps>(originalProps, watermarkDefaultProps);\n  const {\n    alpha,\n    x = 200,\n    y = 210,\n    width = 120,\n    height = 60,\n    rotate: tempRotate,\n    zIndex = 10,\n    lineSpace,\n    isRepeat,\n    removable,\n    movable,\n    moveInterval,\n    offset = [],\n    content,\n    children,\n    watermarkContent,\n    className,\n    style = {},\n  } = props;\n\n  const { classPrefix } = useConfig();\n\n  let gapX = x;\n  let gapY = y;\n  let rotate = tempRotate;\n  if (movable) {\n    gapX = 0;\n    gapY = 0;\n    rotate = 0;\n  }\n  const clsName = `${classPrefix}-watermark`;\n  const [base64Url, setBase64Url] = useState('');\n  const styleStr = useRef('');\n  const watermarkRef = useRef<HTMLDivElement>(null);\n  const watermarkImgRef = useRef<HTMLDivElement>(null);\n  const stopObservation = useRef(false);\n  const offsetLeft = offset[0] || gapX / 2;\n  const offsetTop = offset[1] || gapY / 2;\n\n  // 水印节点 - 背景base64\n  useEffect(() => {\n    generateBase64Url(\n      {\n        width,\n        height,\n        rotate,\n        lineSpace,\n        alpha,\n        gapX,\n        gapY,\n        watermarkContent,\n        offsetLeft,\n        offsetTop,\n      },\n      (url) => {\n        setBase64Url(url);\n      },\n    );\n  }, [width, height, rotate, zIndex, lineSpace, alpha, offsetLeft, offsetTop, gapX, gapY, watermarkContent]);\n\n  // 水印节点 - styleStr\n  useEffect(() => {\n    styleStr.current = getStyleStr({\n      zIndex,\n      position: 'absolute',\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n      width: movable ? `${width}px` : '100%',\n      height: movable ? `${height}px` : '100%',\n      backgroundSize: `${gapX + width}px`,\n      pointerEvents: 'none',\n      backgroundRepeat: movable ? 'no-repeat' : isRepeat ? 'repeat' : 'no-repeat',\n      backgroundImage: `url('${base64Url}')`,\n      animation: movable ? `watermark infinite ${(moveInterval * 4) / 60}s` : 'none',\n      ...style,\n    });\n  }, [zIndex, gapX, width, movable, isRepeat, base64Url, moveInterval, style, height]);\n\n  // 水印节点 - 渲染\n  const renderWatermark = useCallback(() => {\n    // 停止监听\n    stopObservation.current = true;\n    // 删除之前\n    watermarkImgRef.current?.remove?.();\n    watermarkImgRef.current = undefined;\n    // 创建新的\n    watermarkImgRef.current = document.createElement('div');\n    watermarkImgRef.current.setAttribute('style', styleStr.current);\n    watermarkRef.current?.append(watermarkImgRef.current);\n    // 继续监听\n    setTimeout(() => {\n      stopObservation.current = false;\n    });\n  }, []);\n\n  // 水印节点 - 初始化渲染\n  useEffect(() => {\n    renderWatermark();\n  }, [renderWatermark, zIndex, gapX, width, movable, isRepeat, base64Url, moveInterval, style, className]);\n\n  // 水印节点 - 变化时重新渲染\n  useMutationObserver(watermarkRef.current, (mutations) => {\n    if (stopObservation.current) return;\n    if (removable) return;\n    mutations.forEach((mutation) => {\n      // 水印节点被删除\n      if (mutation.type === 'childList') {\n        const removeNodes = mutation.removedNodes;\n        removeNodes.forEach((node) => {\n          const element = node as HTMLElement;\n          if (element === watermarkImgRef.current) {\n            renderWatermark();\n          }\n        });\n      }\n      // 水印节点其他变化\n      if (mutation.target === watermarkImgRef.current) {\n        renderWatermark();\n      }\n    });\n  });\n\n  // 组件父节点 - 增加keyframes\n  const parent = useRef<HTMLElement>(null);\n  useEffect(() => {\n    parent.current = watermarkRef.current.parentElement;\n    const keyframesStyle = randomMovingStyle();\n    injectStyle(keyframesStyle);\n  }, []);\n\n  // 水印节点的父节点 - 防删除\n  useMutationObserver(typeof document !== 'undefined' ? document.body : null, (mutations) => {\n    if (removable) return;\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'childList') {\n        const removeNodes = mutation.removedNodes;\n        removeNodes.forEach((node) => {\n          const element = node as HTMLElement;\n          if (element === watermarkRef.current) {\n            parent.current.appendChild(element);\n          }\n        });\n      }\n    });\n  });\n\n  return (\n    <div className={classNames([clsName, className])} ref={watermarkRef}>\n      {children || content}\n    </div>\n  );\n};\n\nexport default Watermark;\n"],"names":["generateBase64Url","_ref","onFinish","width","height","gapX","gapY","offsetLeft","offsetTop","rotate","alpha","watermarkContent","lineSpace","canvas","document","createElement","ctx","getContext","console","warn","ratio","window","devicePixelRatio","canvasWidth","canvasHeight","style","concat","translate","Math","PI","Number","globalAlpha","markWidth","markHeight","fillStyle","fillRect","contents","Array","isArray","_objectSpread","top","forEach","item","url","_item$isGrayscale","isGrayscale","img","Image","crossOrigin","referrerPolicy","src","onload","drawImage","imgData","getImageData","pixels","data","i","length","lightness","putImageData","toDataURL","text","_item$fontColor","fontColor","_item$fontSize","fontSize","_item$fontFamily","fontFamily","_item$fontWeight","fontWeight","markSize","font","textAlign","textBaseline","fillText","randomMovingStyle","align","floor","random","p1","leftTopLimit","bottomLimit","rightLimit","keyframesStyle","injectStyle","styleElement","styleSheet","head","appendChild","sheet","insertRule","cssRules","Watermark","originalProps","props","useDefaultProps","watermarkDefaultProps","_props$x","x","_props$y","y","_props$width","_props$height","tempRotate","_props$zIndex","zIndex","isRepeat","removable","movable","moveInterval","_props$offset","offset","content","children","className","_props$style","_useConfig","useConfig","classPrefix","clsName","_useState","useState","_useState2","_slicedToArray","base64Url","setBase64Url","styleStr","useRef","watermarkRef","watermarkImgRef","stopObservation","useEffect","current","getStyleStr","position","left","right","bottom","backgroundSize","pointerEvents","backgroundRepeat","backgroundImage","animation","renderWatermark","useCallback","_watermarkImgRef$curr","_watermarkImgRef$curr2","_watermarkRef$current","remove","call","setAttribute","append","setTimeout","useMutationObserver","mutations","mutation","type","removeNodes","removedNodes","node","element","target","parent","parentElement","body","React","classNames","ref"],"mappings":"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"}