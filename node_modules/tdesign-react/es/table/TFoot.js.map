{"version":3,"file":"TFoot.js","sources":["../../../components/table/TFoot.tsx"],"sourcesContent":["import React, { CSSProperties, useRef } from 'react';\nimport { isFunction, get } from 'lodash-es';\nimport classNames from 'classnames';\nimport { BaseTableCellParams, RowspanColspan, TableRowData, TdBaseTableProps } from './type';\nimport { formatRowAttributes, formatRowClassNames } from './utils';\nimport { RowAndColFixedPosition } from './interface';\nimport { getColumnFixedStyles } from './hooks/useFixed';\nimport useRowspanAndColspan, { getCellKey } from './hooks/useRowspanAndColspan';\nimport useClassName from './hooks/useClassName';\n\nexport interface TFootProps {\n  rowKey: string;\n  // 是否固定表头\n  isFixedHeader: boolean;\n  // 固定列 left/right 具体值\n  rowAndColFixedPosition: RowAndColFixedPosition;\n  footData: TdBaseTableProps['footData'];\n  columns: TdBaseTableProps['columns'];\n  rowAttributes: TdBaseTableProps['rowAttributes'];\n  rowClassName: TdBaseTableProps['rowClassName'];\n  // 表尾吸底内容宽度\n  thWidthList?: { [colKey: string]: number };\n  footerSummary?: TdBaseTableProps['footerSummary'];\n  rowspanAndColspanInFooter: TdBaseTableProps['rowspanAndColspanInFooter'];\n  virtualScroll?: Boolean;\n}\n\nexport default function TFoot(props: TFootProps) {\n  const { footData, columns, rowKey, footerSummary, virtualScroll } = props;\n  const tfooterRef = useRef<HTMLTableSectionElement>(null);\n  const classnames = useClassName();\n\n  const { skipSpansMap } = useRowspanAndColspan(footData, columns, rowKey, props.rowspanAndColspanInFooter);\n\n  const renderTFootCell = (p: BaseTableCellParams<TableRowData>) => {\n    const { col, row } = p;\n    if (isFunction(col.foot)) {\n      return col.foot(p);\n    }\n    return col.foot || get(row, col.colKey);\n  };\n\n  const theadClasses = [\n    classnames.tableFooterClasses.footer,\n    { [classnames.tableFooterClasses.fixed]: props.isFixedHeader },\n  ];\n\n  if (!columns) return null;\n\n  const footerDomList = footData?.map((row, rowIndex) => {\n    const trAttributes = formatRowAttributes(props.rowAttributes, { row, rowIndex, type: 'foot' });\n    // 自定义行类名\n    const customClasses = formatRowClassNames(\n      props.rowClassName,\n      { row, rowIndex, type: 'foot' },\n      props.rowKey || 'id',\n    );\n    return (\n      <tr key={rowIndex} {...trAttributes} className={classNames(customClasses)}>\n        {columns.map((col, colIndex) => {\n          // 合并单元格过滤\n          const cellSpans: RowspanColspan = {};\n          let spanState = null;\n          if (skipSpansMap.size) {\n            const cellKey = getCellKey(row, rowKey, col.colKey, colIndex);\n            spanState = skipSpansMap.get(cellKey) || {};\n            spanState?.rowspan > 1 && (cellSpans.rowspan = spanState.rowspan);\n            spanState?.colspan > 1 && (cellSpans.colspan = spanState.colspan);\n            if (spanState.skipped) return null;\n          }\n          const tdStyles = getColumnFixedStyles(\n            col,\n            colIndex,\n            props.rowAndColFixedPosition,\n            classnames.tableColFixedClasses,\n          );\n          const style: CSSProperties = { ...tdStyles.style };\n          if (props.thWidthList?.[col.colKey]) {\n            style.width = `${props.thWidthList[col.colKey] || 0}px`;\n          }\n          return (\n            <td\n              key={col.colKey}\n              rowSpan={cellSpans.rowspan}\n              colSpan={cellSpans.colspan}\n              className={classNames(tdStyles.classes)}\n              style={style}\n            >\n              {renderTFootCell({\n                row,\n                rowIndex,\n                col,\n                colIndex,\n              })}\n            </td>\n          );\n        })}\n      </tr>\n    );\n  });\n\n  // 都不存在，则不需要渲染 footer\n  if (!footerSummary && (!props.footData || !props.footData.length)) return null;\n  return (\n    // 虚拟滚动下，不显示 footer，但预留元素，用于高度计算\n    <tfoot\n      ref={tfooterRef}\n      className={classNames(theadClasses)}\n      style={{ visibility: virtualScroll ? 'hidden' : 'visible' }}\n    >\n      {footerSummary && (\n        <tr className={classnames.tableFullRowClasses.base}>\n          <td colSpan={columns.length}>\n            <div className={classnames.tableFullRowClasses.innerFullElement}>{footerSummary}</div>\n          </td>\n        </tr>\n      )}\n      {footerDomList}\n    </tfoot>\n  );\n}\n"],"names":["TFoot","props","footData","columns","rowKey","footerSummary","virtualScroll","tfooterRef","useRef","classnames","useClassName","_useRowspanAndColspan","useRowspanAndColspan","rowspanAndColspanInFooter","skipSpansMap","renderTFootCell","p","col","row","isFunction","foot","get","colKey","theadClasses","tableFooterClasses","footer","_defineProperty","fixed","isFixedHeader","footerDomList","map","rowIndex","trAttributes","formatRowAttributes","rowAttributes","type","customClasses","formatRowClassNames","rowClassName","React","createElement","_objectSpread","key","className","classNames","colIndex","_props$thWidthList","cellSpans","spanState","size","_spanState","_spanState2","cellKey","getCellKey","rowspan","colspan","skipped","tdStyles","getColumnFixedStyles","rowAndColFixedPosition","tableColFixedClasses","style","thWidthList","width","concat","rowSpan","colSpan","classes","length","ref","visibility","tableFullRowClasses","base","innerFullElement"],"mappings":"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"}