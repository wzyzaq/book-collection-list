{"version":3,"file":"usePagination.js","sources":["../../../../components/table/hooks/usePagination.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport useConfig from '../../hooks/useConfig';\nimport Pagination, { PageInfo, PaginationProps } from '../../pagination';\nimport { TdBaseTableProps, TableRowData } from '../type';\n\n// 分页功能包含：远程数据排序受控、远程数据排序非受控、本地数据排序受控、本地数据排序非受控 等 4 类功能\nexport default function usePagination(props: TdBaseTableProps) {\n  const { pagination, data, disableDataPage } = props;\n  const { classPrefix } = useConfig();\n  const [innerPagination, setInnerPagination] = useState<PaginationProps>(props.pagination);\n\n  const [dataSource, setDataSource] = useState<TableRowData[]>([]);\n  const [isPaginateData, setIsPaginateData] = useState(false);\n\n  const updateDataSourceAndPaginate = useCallback(\n    (current = 1, pageSize = 10) => {\n      // data 数据数量超出分页大小时，则自动启动本地数据分页\n      const isPaginateData = Boolean(!disableDataPage && data.length > pageSize);\n      setIsPaginateData(isPaginateData);\n      let newData: TableRowData[] = [];\n      if (isPaginateData) {\n        const start = (current - 1) * pageSize;\n        const end = current * pageSize;\n        newData = [...data.slice(start, end)];\n      } else {\n        newData = data;\n      }\n      setDataSource(newData);\n      return newData;\n    },\n    [data, disableDataPage],\n  );\n\n  useEffect(() => {\n    if (!pagination) {\n      setIsPaginateData(false);\n    }\n  }, [pagination]);\n\n  // 受控情况，只有 pagination.current 或者 pagination.pageSize 变化，才对数据进行排序\n  useEffect(() => {\n    if (!pagination || !pagination.current) return;\n    const [current, pageSize] = [pagination?.current, pagination?.pageSize ?? 10];\n    updateDataSourceAndPaginate(current, pageSize);\n    setInnerPagination({ current, pageSize });\n  }, [pagination, updateDataSourceAndPaginate]);\n\n  // 非受控情况\n  useEffect(() => {\n    if (!pagination || !pagination.defaultCurrent) return;\n    // 存在受控属性时，立即返回不再执行后续内容\n    const isControlled = Boolean(pagination.current);\n    if (isControlled) return;\n    updateDataSourceAndPaginate(\n      innerPagination.current ?? pagination.defaultCurrent,\n      innerPagination.pageSize ?? pagination.defaultPageSize,\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [updateDataSourceAndPaginate]);\n\n  const renderPagination = () => {\n    if (!pagination) return null;\n    return (\n      <div className={`${classPrefix}-table__pagination`}>\n        <Pagination\n          {...pagination}\n          onChange={(pageInfo: PageInfo) => {\n            props.pagination?.onChange?.(pageInfo);\n            setInnerPagination(pageInfo);\n            const newData = updateDataSourceAndPaginate(pageInfo.current, pageInfo.pageSize);\n            props.onPageChange?.(pageInfo, newData);\n          }}\n        />\n      </div>\n    );\n  };\n\n  return {\n    isPaginateData,\n    dataSource,\n    innerPagination,\n    renderPagination,\n  };\n}\n"],"names":["usePagination","props","pagination","data","disableDataPage","_useConfig","useConfig","classPrefix","_useState","useState","_useState2","_slicedToArray","innerPagination","setInnerPagination","_useState3","_useState4","dataSource","setDataSource","_useState5","_useState6","isPaginateData","setIsPaginateData","updateDataSourceAndPaginate","useCallback","current","arguments","length","undefined","pageSize","Boolean","newData","start","end","_toConsumableArray","slice","useEffect","_pagination$pageSize","_innerPagination$curr","_innerPagination$page","defaultCurrent","isControlled","defaultPageSize","renderPagination","React","createElement","className","Pagination","_objectSpread","onChange","pageInfo","_props$pagination","_props$pagination$onC","_props$onPageChange","call","onPageChange"],"mappings":"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"}