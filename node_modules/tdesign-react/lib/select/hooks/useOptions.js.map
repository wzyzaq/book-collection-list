{"version":3,"file":"useOptions.js","sources":["../../../../components/select/hooks/useOptions.ts"],"sourcesContent":["import React, { useState, useEffect, ReactNode, ReactElement } from 'react';\nimport { get } from 'lodash-es';\nimport { SelectKeysType, SelectOption, SelectValue } from '../type';\nimport { getValueToOption } from '../util/helper';\nimport Option from '../base/Option';\nimport OptionGroup from '../base/OptionGroup';\n\n// 处理 options 的逻辑\nfunction UseOptions(\n  keys: SelectKeysType,\n  options: SelectOption[],\n  children: ReactNode,\n  valueType: 'object' | 'value',\n  value: SelectValue<SelectOption>,\n  reserveKeyword: boolean,\n) {\n  const [valueToOption, setValueToOption] = useState({});\n  const [currentOptions, setCurrentOptions] = useState([]);\n  const [tmpPropOptions, setTmpPropOptions] = useState([]);\n  const [selectedOptions, setSelectedOptions] = useState([]);\n\n  // 处理设置 option 的逻辑\n  useEffect(() => {\n    let transformedOptions = options;\n\n    const arrayChildren = React.Children.toArray(children);\n    const optionChildren = arrayChildren.filter((v: ReactElement) => v.type === Option || v.type === OptionGroup);\n    const isChildrenFilterable = arrayChildren.length > 0 && optionChildren.length === arrayChildren.length;\n    if (reserveKeyword && currentOptions.length && isChildrenFilterable) return;\n\n    if (isChildrenFilterable) {\n      const handlerOptionElement = (v) => {\n        if (React.isValidElement<SelectOption>(v)) {\n          if (v.type === OptionGroup) {\n            return {\n              ...v.props,\n              group: v.props.label,\n              children: v.props.children?.map((v) => handlerOptionElement(v)),\n            };\n          }\n          return {\n            ...v.props,\n            label: v.props.label || v.props.children,\n          };\n        }\n        return { label: v };\n      };\n      transformedOptions = arrayChildren?.map<SelectOption>((v) => handlerOptionElement(v));\n    }\n    if (keys) {\n      // 如果有定制 keys 先做转换\n      transformedOptions = transformedOptions?.map<SelectOption>((option) => ({\n        ...option,\n        value: get(option, keys?.value || 'value'),\n        label: get(option, keys?.label || 'label'),\n      }));\n    }\n    setCurrentOptions(transformedOptions);\n    setTmpPropOptions(transformedOptions);\n\n    setValueToOption(getValueToOption(children as ReactElement, options as any, keys) || {});\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [options, keys, children, reserveKeyword]);\n\n  // 同步 value 对应的 options\n  useEffect(() => {\n    setSelectedOptions((oldSelectedOptions: SelectOption[]) => {\n      const valueKey = keys?.value || 'value';\n      const labelKey = keys?.label || 'label';\n      if (Array.isArray(value)) {\n        return value\n          .map((item: SelectValue<SelectOption>) => {\n            if (valueType === 'value') {\n              return (\n                valueToOption[item as string | number] ||\n                oldSelectedOptions.find((option) => get(option, valueKey) === item) || {\n                  [valueKey]: item,\n                  [labelKey]: item,\n                }\n              );\n            }\n            return item;\n          })\n          .filter(Boolean);\n      }\n\n      if (value !== undefined && value !== null) {\n        if (valueType === 'value') {\n          return [\n            valueToOption[value as string | number] ||\n              oldSelectedOptions.find((option) => get(option, valueKey) === value) || {\n                [valueKey]: value,\n                [labelKey]: value,\n              },\n          ].filter(Boolean);\n        }\n        return [value];\n      }\n      return [];\n    });\n  }, [value, keys, valueType, valueToOption, setSelectedOptions]);\n\n  return {\n    currentOptions,\n    setCurrentOptions,\n    tmpPropOptions,\n    setTmpPropOptions,\n    valueToOption,\n    setValueToOption,\n    selectedOptions,\n    setSelectedOptions,\n  };\n}\n\nexport default UseOptions;\n"],"names":["UseOptions","keys","options","children","valueType","value","reserveKeyword","_useState","useState","_useState2","_slicedToArray","valueToOption","setValueToOption","_useState3","_useState4","currentOptions","setCurrentOptions","_useState5","_useState6","tmpPropOptions","setTmpPropOptions","_useState7","_useState8","selectedOptions","setSelectedOptions","useEffect","transformedOptions","arrayChildren","React","Children","toArray","optionChildren","filter","v","type","Option","OptionGroup","isChildrenFilterable","length","handlerOptionElement","isValidElement","_v$props$children","_objectSpread","props","group","label","map","_transformedOptions","option","get","getValueToOption","oldSelectedOptions","valueKey","labelKey","Array","isArray","item","find","_defineProperty","Boolean"],"mappings":"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"}