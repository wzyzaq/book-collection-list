{"version":3,"file":"Ellipsis.js","sources":["../../../components/table/Ellipsis.tsx"],"sourcesContent":["import React, { useRef, useState, MouseEvent } from 'react';\nimport classNames from 'classnames';\n\nimport { TNode } from '../common';\nimport { isNodeOverflow } from '../_util/dom';\nimport Tooltip, { TooltipProps } from '../tooltip';\nimport useDebounce from '../hooks/useDebounce';\n\nexport interface EllipsisProps {\n  content?: string | TNode;\n  children?: string | TNode;\n  popupContent?: string | number | TNode;\n  placement?: TooltipProps['placement'];\n  attach?: () => HTMLElement;\n  tooltipProps?: TooltipProps;\n  zIndex?: number;\n  overlayClassName?: string;\n  classPrefix?: string;\n}\n\n/** 超出省略显示 */\nexport default function Ellipsis(props: EllipsisProps) {\n  const { classPrefix } = props;\n  const root = useRef<HTMLDivElement>(null);\n  const [isOverflow, setIsOverflow] = useState(false);\n\n  const ellipsisClasses = classNames([`${classPrefix}-table__ellipsis`, `${classPrefix}-text-ellipsis`]);\n\n  const innerEllipsisClassName: TooltipProps['overlayClassName'] = [\n    `${classPrefix}-table__ellipsis-content`,\n    props.overlayClassName,\n  ];\n\n  // 当表格数据量大时，不希望默认渲染全量的 Popup，期望在用户 mouseenter 的时候再显示\n  const onTriggerMouseenter = () => {\n    if (!root.current) return;\n    setIsOverflow(isNodeOverflow(root.current));\n  };\n\n  const onTriggerMouseleave = () => {\n    setIsOverflow(isNodeOverflow(root.current));\n  };\n\n  // 使用 debounce 有两个原因：1. 避免 safari/firefox 等浏览器不显示省略浮层；2. 避免省略列快速滚动时，出现一堆的省略浮层\n  const onMouseAround = useDebounce((e: MouseEvent<HTMLDivElement>) => {\n    e.type === 'mouseleave' ? onTriggerMouseleave() : onTriggerMouseenter();\n  }, 80);\n\n  const cellNode = props.content || props.children;\n  const ellipsisContent = (\n    <div ref={root} className={ellipsisClasses} onMouseEnter={onMouseAround} onMouseLeave={onMouseAround}>\n      {cellNode}\n    </div>\n  );\n  let content = null;\n  const { tooltipProps } = props;\n  if (isOverflow) {\n    const rProps = {\n      content: props.popupContent || cellNode,\n      destroyOnClose: true,\n      zIndex: props.zIndex,\n      attach: props.attach,\n      placement: props.placement,\n      overlayClassName: tooltipProps?.overlayClassName\n        ? innerEllipsisClassName.concat(tooltipProps.overlayClassName)\n        : innerEllipsisClassName,\n      ...(props.tooltipProps || {}),\n    };\n    content = <Tooltip {...rProps}>{ellipsisContent}</Tooltip>;\n  } else {\n    content = ellipsisContent;\n  }\n  return content;\n}\n\nEllipsis.displayName = 'Ellipsis';\n"],"names":["Ellipsis","props","classPrefix","root","useRef","_useState","useState","_useState2","_slicedToArray","isOverflow","setIsOverflow","ellipsisClasses","classNames","concat","innerEllipsisClassName","overlayClassName","onTriggerMouseenter","current","isNodeOverflow","onTriggerMouseleave","onMouseAround","useDebounce","e","type","cellNode","content","children","ellipsisContent","React","createElement","ref","className","onMouseEnter","onMouseLeave","tooltipProps","rProps","_objectSpread","popupContent","destroyOnClose","zIndex","attach","placement","Tooltip","displayName"],"mappings":"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"}