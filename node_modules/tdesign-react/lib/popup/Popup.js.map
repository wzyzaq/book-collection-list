{"version":3,"file":"Popup.js","sources":["../../../components/popup/Popup.tsx"],"sourcesContent":["import React, { forwardRef, useState, useRef, useMemo, useEffect, useImperativeHandle } from 'react';\nimport { CSSTransition } from 'react-transition-group';\nimport { isFunction, debounce } from 'lodash-es';\nimport classNames from 'classnames';\nimport { Placement } from '@popperjs/core';\nimport useControlled from '../hooks/useControlled';\nimport useAnimation from '../hooks/useAnimation';\nimport useConfig from '../hooks/useConfig';\nimport { TdPopupProps } from './type';\nimport Portal from '../common/Portal';\nimport useTrigger from './hooks/useTrigger';\nimport { getRefDom } from '../_util/ref';\nimport { getTransitionParams } from './utils/transition';\nimport useMutationObserver from '../hooks/useMutationObserver';\nimport useWindowSize from '../hooks/useWindowSize';\nimport { popupDefaultProps } from './defaultProps';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport useAttach from '../hooks/useAttach';\nimport usePopper from '../hooks/usePopper';\n\nimport { getCssVarsValue } from '../_util/dom';\n\nexport interface PopupProps extends TdPopupProps {\n  // 是否触发展开收起动画，内部下拉式组件使用\n  expandAnimation?: boolean;\n  // 更新内容区域滚动条\n  updateScrollTop?: (content: HTMLDivElement) => void;\n}\n\nexport interface PopupRef {\n  /** 获取 popper 实例 */\n  getPopper: () => ReturnType<typeof usePopper>;\n  /** 获取 Popup dom 元素 */\n  getPopupElement: () => HTMLDivElement;\n  /** 获取 portal dom 元素 */\n  getPortalElement: () => HTMLDivElement;\n  /** 获取内容区域 dom 元素 */\n  getPopupContentElement: () => HTMLDivElement;\n  /** 设置 popup 显示隐藏 */\n  setVisible: (visible: boolean) => void;\n}\n\nconst Popup = forwardRef<PopupRef, PopupProps>((originalProps, ref) => {\n  const props = useDefaultProps<PopupProps>(originalProps, popupDefaultProps);\n  const {\n    trigger,\n    content,\n    placement,\n    attach,\n    showArrow,\n    destroyOnClose,\n    overlayClassName,\n    overlayInnerClassName,\n    overlayStyle,\n    overlayInnerStyle,\n    triggerElement,\n    children = triggerElement,\n    disabled,\n    zIndex,\n    onScroll,\n    onScrollToBottom,\n    expandAnimation,\n    delay,\n    hideEmptyPopup,\n    popperOptions,\n    updateScrollTop,\n  } = props;\n  const { classPrefix } = useConfig();\n  const popupAttach = useAttach('popup', attach);\n\n  // 全局配置\n  const { keepExpand, keepFade } = useAnimation();\n  const { height: windowHeight, width: windowWidth } = useWindowSize();\n  const [visible, onVisibleChange] = useControlled(props, 'visible', props.onVisibleChange);\n\n  const [popupElement, setPopupElement] = useState(null);\n  const triggerRef = useRef(null); // 记录 trigger 元素\n  const popupRef = useRef(null); // popup dom 元素，css transition 需要用\n  const portalRef = useRef(null); // portal dom 元素\n  const contentRef = useRef(null); // 内容部分\n  const popperRef = useRef(null); // 保存 popper 实例\n\n  // 默认动画时长\n  const DEFAULT_TRANSITION_TIMEOUT = 180;\n\n  // 处理切换 panel 为 null 和正常内容动态切换的情况\n  useEffect(() => {\n    if (!content && hideEmptyPopup) {\n      requestAnimationFrame(() => setPopupElement(null));\n    }\n  }, [content, hideEmptyPopup]);\n\n  // 判断展示浮层\n  const showOverlay = useMemo(() => {\n    if (hideEmptyPopup && !content) return false;\n    return visible || popupElement;\n  }, [hideEmptyPopup, content, visible, popupElement]);\n\n  // 转化 placement\n  const popperPlacement = useMemo(\n    () => placement.replace(/-(left|top)$/, '-start').replace(/-(right|bottom)$/, '-end') as Placement,\n    [placement],\n  );\n\n  const { getTriggerNode, getPopupProps, getTriggerDom } = useTrigger({\n    triggerRef,\n    content,\n    disabled,\n    trigger,\n    visible,\n    delay,\n    onVisibleChange,\n  });\n\n  popperRef.current = usePopper(getRefDom(triggerRef), popupElement, {\n    placement: popperPlacement,\n    ...popperOptions,\n  });\n  const { styles, attributes } = popperRef.current;\n\n  const triggerNode = isFunction(children) ? getTriggerNode(children({ visible })) : getTriggerNode(children);\n\n  const updateTimeRef = useRef(null);\n  // 监听 trigger 节点或内容变化动态更新 popup 定位\n  useMutationObserver(getRefDom(triggerRef), () => {\n    const isDisplayNone = getCssVarsValue('display', getRefDom(triggerRef)) === 'none';\n    if (visible && !isDisplayNone) {\n      clearTimeout(updateTimeRef.current);\n      updateTimeRef.current = setTimeout(() => popperRef.current?.update?.(), 0);\n    }\n  });\n  useEffect(() => () => clearTimeout(updateTimeRef.current), []);\n\n  // 窗口尺寸变化时调整位置\n  useEffect(() => {\n    if (visible) {\n      requestAnimationFrame(() => popperRef.current?.update?.());\n    }\n  }, [visible, content, windowHeight, windowWidth]);\n\n  // 下拉展开时更新内部滚动条\n  useEffect(() => {\n    if (!triggerRef.current) triggerRef.current = getTriggerDom();\n    if (visible) {\n      updateScrollTop?.(contentRef.current);\n    }\n  }, [visible, updateScrollTop, getTriggerDom]);\n\n  function handleExited() {\n    !destroyOnClose && popupElement && (popupElement.style.display = 'none');\n  }\n  function handleEnter() {\n    !destroyOnClose && popupElement && (popupElement.style.display = 'block');\n  }\n\n  function handleScroll(e: React.WheelEvent<HTMLDivElement>) {\n    onScroll?.({ e });\n\n    // 防止多次触发添加截流\n    const debounceOnScrollBottom = debounce((e) => onScrollToBottom?.({ e }), 100);\n\n    const { scrollTop, clientHeight, scrollHeight } = e.target as HTMLDivElement;\n    // windows 下滚动会出现小数，所以这里取整\n    if (clientHeight + Math.floor(scrollTop) === scrollHeight) {\n      // touch bottom\n      debounceOnScrollBottom(e);\n    }\n  }\n\n  // 整理浮层样式\n  function getOverlayStyle(overlayStyle: TdPopupProps['overlayStyle']) {\n    if (getRefDom(triggerRef) && popupRef.current && typeof overlayStyle === 'function') {\n      return { ...overlayStyle(getRefDom(triggerRef), popupRef.current) };\n    }\n    return { ...overlayStyle };\n  }\n\n  const overlay = showOverlay && (\n    <CSSTransition\n      appear\n      in={visible}\n      timeout={DEFAULT_TRANSITION_TIMEOUT}\n      nodeRef={portalRef}\n      unmountOnExit={destroyOnClose}\n      onEnter={handleEnter}\n      onExited={handleExited}\n    >\n      <Portal triggerNode={getRefDom(triggerRef)} attach={popupAttach} ref={portalRef}>\n        <CSSTransition\n          appear\n          timeout={0}\n          in={visible}\n          nodeRef={popupRef}\n          {...getTransitionParams({\n            classPrefix,\n            fadeAnimation: keepFade,\n            expandAnimation: expandAnimation && keepExpand,\n          })}\n        >\n          <div\n            ref={(node) => {\n              if (node) {\n                popupRef.current = node;\n                setPopupElement(node);\n              }\n            }}\n            style={{ ...styles.popper, zIndex, ...getOverlayStyle(overlayStyle) }}\n            className={classNames(`${classPrefix}-popup`, overlayClassName)}\n            {...attributes.popper}\n            {...getPopupProps()}\n          >\n            <div\n              ref={contentRef}\n              className={classNames(\n                `${classPrefix}-popup__content`,\n                {\n                  [`${classPrefix}-popup__content--arrow`]: showArrow,\n                },\n                overlayInnerClassName,\n              )}\n              style={getOverlayStyle(overlayInnerStyle)}\n              onScroll={handleScroll}\n            >\n              {content}\n              {showArrow ? (\n                // popper.js 修饰符(modifiers)的高级功能 arrow 会自动根据属性 data-popper-arrow 来识别箭头元素，从而支持调整箭头位置(padding)\n                <div style={styles.arrow} className={`${classPrefix}-popup__arrow`} data-popper-arrow />\n              ) : null}\n            </div>\n          </div>\n        </CSSTransition>\n      </Portal>\n    </CSSTransition>\n  );\n\n  useImperativeHandle(ref, () => ({\n    getPopper: () => popperRef.current,\n    getPopupElement: () => popupRef.current,\n    getPortalElement: () => portalRef.current,\n    getPopupContentElement: () => contentRef.current,\n    setVisible: (visible: boolean) => onVisibleChange(visible, { trigger: 'document' }),\n  }));\n\n  return (\n    <React.Fragment>\n      {triggerNode}\n      {overlay}\n    </React.Fragment>\n  );\n});\n\nPopup.displayName = 'Popup';\n\nexport default Popup;\n"],"names":["Popup","forwardRef","originalProps","ref","props","useDefaultProps","popupDefaultProps","trigger","content","placement","attach","showArrow","destroyOnClose","overlayClassName","overlayInnerClassName","overlayStyle","overlayInnerStyle","triggerElement","_props$children","children","disabled","zIndex","onScroll","onScrollToBottom","expandAnimation","delay","hideEmptyPopup","popperOptions","updateScrollTop","_useConfig","useConfig","classPrefix","popupAttach","useAttach","_useAnimation","useAnimation","keepExpand","keepFade","_useWindowSize","useWindowSize","windowHeight","height","windowWidth","width","_useControlled","useControlled","onVisibleChange","_useControlled2","_slicedToArray","visible","_useState","useState","_useState2","popupElement","setPopupElement","triggerRef","useRef","popupRef","portalRef","contentRef","popperRef","DEFAULT_TRANSITION_TIMEOUT","useEffect","requestAnimationFrame","showOverlay","useMemo","popperPlacement","replace","_useTrigger","useTrigger","getTriggerNode","getPopupProps","getTriggerDom","current","usePopper","getRefDom","_objectSpread","_popperRef$current","styles","attributes","triggerNode","isFunction","updateTimeRef","useMutationObserver","isDisplayNone","getCssVarsValue","clearTimeout","setTimeout","_popperRef$current2","_popperRef$current2$u","update","call","_popperRef$current3","_popperRef$current3$u","handleExited","style","display","handleEnter","handleScroll","e","debounceOnScrollBottom","debounce","_e$target","target","scrollTop","clientHeight","scrollHeight","Math","floor","getOverlayStyle","overlay","React","createElement","CSSTransition","appear","timeout","nodeRef","unmountOnExit","onEnter","onExited","Portal","getTransitionParams","fadeAnimation","node","popper","className","classNames","concat","_defineProperty","arrow","useImperativeHandle","getPopper","getPopupElement","getPortalElement","getPopupContentElement","setVisible","Fragment","displayName"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0CMA,IAAAA,KAAQ,gBAAAC,UAAA,CAAiC,UAACC,aAAA,EAAeC,GAAQ,EAAA;AAC/D,EAAA,IAAAC,KAAA,GAAQC,eAA4B,CAAAH,aAAA,EAAeI,iBAAiB,CAAA,CAAA;AACpE,EAAA,IACJC,OAAA,GAqBEH,KAAA,CArBFG,OAAA;IACAC,OAAA,GAoBEJ,KAAA,CApBFI,OAAA;IACAC,SAAA,GAmBEL,KAAA,CAnBFK,SAAA;IACAC,MAAA,GAkBEN,KAAA,CAlBFM,MAAA;IACAC,SAAA,GAiBEP,KAAA,CAjBFO,SAAA;IACAC,cAAA,GAgBER,KAAA,CAhBFQ,cAAA;IACAC,gBAAA,GAeET,KAAA,CAfFS,gBAAA;IACAC,qBAAA,GAcEV,KAAA,CAdFU,qBAAA;IACAC,YAAA,GAaEX,KAAA,CAbFW,YAAA;IACAC,iBAAA,GAYEZ,KAAA,CAZFY,iBAAA;IACAC,cAAA,GAWEb,KAAA,CAXFa,cAAA;IAAAC,eAAA,GAWEd,KAAA,CAVFe,QAAW;AAAXA,IAAAA,QAAW,GAAAD,eAAA,KAAAD,KAAAA,CAAAA,GAAAA,cAAA,GAAAC,eAAA;IACXE,QAAA,GASEhB,KAAA,CATFgB,QAAA;IACAC,MAAA,GAQEjB,KAAA,CARFiB,MAAA;IACAC,QAAA,GAOElB,KAAA,CAPFkB,QAAA;IACAC,gBAAA,GAMEnB,KAAA,CANFmB,gBAAA;IACAC,eAAA,GAKEpB,KAAA,CALFoB,eAAA;IACAC,KAAA,GAIErB,KAAA,CAJFqB,KAAA;IACAC,cAAA,GAGEtB,KAAA,CAHFsB,cAAA;IACAC,aAAA,GAEEvB,KAAA,CAFFuB,aAAA;IACAC,eAAA,GACExB,KAAA,CADFwB,eAAA,CAAA;AAEI,EAAA,IAAAC,UAAA,GAAkBC,SAAU,EAAA;IAA1BC,WAAY,GAAAF,UAAA,CAAZE,WAAY,CAAA;AACd,EAAA,IAAAC,WAAA,GAAcC,SAAU,CAAA,OAAA,EAASvB,MAAM,CAAA,CAAA;AAG7C,EAAA,IAAAwB,aAAA,GAAiCC,YAAa,EAAA;IAAtCC,UAAA,GAAAF,aAAA,CAAAE,UAAA;IAAYC,QAAS,GAAAH,aAAA,CAATG,QAAS,CAAA;AAC7B,EAAA,IAAAC,cAAA,GAAqDC,aAAc,EAAA;IAAnDC,YAAA,GAAAF,cAAA,CAARG,MAAQ;IAAqBC,WAAA,GAAAJ,cAAA,CAAPK,KAAO,CAAA;EAC/B,IAAAC,cAAA,GAA6BC,cAAczC,KAAO,EAAA,SAAA,EAAWA,MAAM0C,eAAe,CAAA;IAAAC,eAAA,GAAAC,cAAA,CAAAJ,cAAA,EAAA,CAAA,CAAA;AAAjFK,IAAAA;AAASH,IAAAA,eAAe,GAAAC,eAAA,CAAA,CAAA,CAAA,CAAA;AAE/B,EAAA,IAAAG,SAAA,GAAwCC,SAAS,IAAI,CAAA;IAAAC,UAAA,GAAAJ,cAAA,CAAAE,SAAA,EAAA,CAAA,CAAA;AAA9CG,IAAAA,YAAA,GAAAD,UAAA,CAAA,CAAA,CAAA;AAAcE,IAAAA,eAAe,GAAAF,UAAA,CAAA,CAAA,CAAA,CAAA;AAC9B,EAAA,IAAAG,UAAA,GAAaC,OAAO,IAAI,CAAA,CAAA;AACxB,EAAA,IAAAC,QAAA,GAAWD,OAAO,IAAI,CAAA,CAAA;AACtB,EAAA,IAAAE,SAAA,GAAYF,OAAO,IAAI,CAAA,CAAA;AACvB,EAAA,IAAAG,UAAA,GAAaH,OAAO,IAAI,CAAA,CAAA;AACxB,EAAA,IAAAI,SAAA,GAAYJ,OAAO,IAAI,CAAA,CAAA;EAG7B,IAAMK,0BAA6B,GAAA,GAAA,CAAA;AAGnCC,EAAAA,SAAA,CAAU,YAAM;AACV,IAAA,IAAA,CAACtD,WAAWkB,cAAgB,EAAA;AACRqC,MAAAA,qBAAA,CAAA,YAAA;QAAA,OAAMT,eAAgB,CAAA,IAAI,CAAC,CAAA;OAAA,CAAA,CAAA;AACnD,KAAA;AACF,GAAG,EAAA,CAAC9C,OAAS,EAAAkB,cAAc,CAAC,CAAA,CAAA;AAGtB,EAAA,IAAAsC,WAAA,GAAcC,QAAQ,YAAM;AAChC,IAAA,IAAIvC,kBAAkB,CAAClB,OAAA,EAAgB,OAAA,KAAA,CAAA;IACvC,OAAOyC,OAAW,IAAAI,YAAA,CAAA;KACjB,CAAC3B,cAAA,EAAgBlB,OAAS,EAAAyC,OAAA,EAASI,YAAY,CAAC,CAAA,CAAA;EAGnD,IAAMa,eAAkB,GAAAD,OAAA,CACtB,YAAA;AAAA,IAAA,OAAMxD,UAAU0D,OAAQ,CAAA,cAAA,EAAgB,QAAQ,CAAE,CAAAA,OAAA,CAAQ,oBAAoB,MAAM,CAAA,CAAA;GACpF,EAAA,CAAC1D,SAAS,CACZ,CAAA,CAAA;EAEA,IAAA2D,WAAA,GAAyDC,UAAW,CAAA;AAClEd,MAAAA,UAAA,EAAAA,UAAA;AACA/C,MAAAA,OAAA,EAAAA,OAAA;AACAY,MAAAA,QAAA,EAAAA,QAAA;AACAb,MAAAA,OAAA,EAAAA,OAAA;AACA0C,MAAAA,OAAA,EAAAA,OAAA;AACAxB,MAAAA,KAAA,EAAAA,KAAA;AACAqB,MAAAA,eAAA,EAAAA,eAAAA;AACF,KAAC,CAAA;IAROwB,cAAA,GAAAF,WAAA,CAAAE,cAAA;IAAgBC,aAAe,GAAAH,WAAA,CAAfG,aAAe;IAAAC,aAAA,GAAAJ,WAAA,CAAAI,aAAA,CAAA;AAUvCZ,EAAAA,SAAA,CAAUa,OAAU,GAAAC,SAAA,CAAUC,SAAU,CAAApB,UAAU,GAAGF,YAAc,EAAAuB,aAAA,CAAA;AACjEnE,IAAAA,SAAW,EAAAyD,eAAAA;GACRvC,EAAAA,aAAA,CACJ,CAAA,CAAA;AACD,EAAA,IAAAkD,kBAAA,GAA+BjB,SAAU,CAAAa,OAAA;IAAjCK,MAAA,GAAAD,kBAAA,CAAAC,MAAA;IAAQC,UAAW,GAAAF,kBAAA,CAAXE,UAAW,CAAA;EAE3B,IAAMC,WAAc,GAAAC,UAAA,CAAW9D,QAAQ,CAAA,GAAImD,cAAe,CAAAnD,QAAA,CAAS;AAAE8B,IAAAA,OAAA,EAAAA,OAAAA;AAAQ,GAAC,CAAC,CAAI,GAAAqB,cAAA,CAAenD,QAAQ,CAAA,CAAA;AAEpG,EAAA,IAAA+D,aAAA,GAAgB1B,OAAO,IAAI,CAAA,CAAA;AAEb2B,EAAAA,qBAAA,CAAAR,SAAA,CAAUpB,UAAU,CAAA,EAAG,YAAM;AAC/C,IAAA,IAAM6B,gBAAgBC,eAAgB,CAAA,SAAA,EAAWV,SAAU,CAAApB,UAAU,CAAC,CAAM,KAAA,MAAA,CAAA;AACxE,IAAA,IAAAN,OAAA,IAAW,CAACmC,aAAe,EAAA;AAC7BE,MAAAA,YAAA,CAAaJ,cAAcT,OAAO,CAAA,CAAA;AAClCS,MAAAA,aAAA,CAAcT,UAAUc,UAAW,CAAA,YAAA;QAAA,IAAAC,mBAAA,EAAAC,qBAAA,CAAA;QAAA,OAAAD,CAAAA,mBAAA,GAAM5B,UAAUa,OAAS,MAAAe,IAAAA,IAAAA,mBAAA,gBAAAC,qBAAA,GAAnBD,mBAAA,CAAmBE,MAAA,cAAAD,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAnBA,qBAAA,CAAAE,IAAA,CAAAH,mBAA4B;SAAG,CAAC,CAAA,CAAA;AAC3E,KAAA;AACF,GAAC,CAAA,CAAA;AACD1B,EAAAA,SAAA,CAAU,YAAA;IAAA,OAAM,YAAA;AAAA,MAAA,OAAMwB,YAAA,CAAaJ,cAAcT,OAAO,CAAA,CAAA;AAAA,KAAA,CAAA;AAAA,GAAA,EAAG,EAAE,CAAA,CAAA;AAG7DX,EAAAA,SAAA,CAAU,YAAM;AACd,IAAA,IAAIb,OAAS,EAAA;AACXc,MAAAA,qBAAA,CAAsB,YAAA;QAAA,IAAA6B,mBAAA,EAAAC,qBAAA,CAAA;QAAA,OAAAD,CAAAA,mBAAA,GAAMhC,SAAA,CAAUa,OAAS,MAAAmB,IAAAA,IAAAA,mBAAA,gBAAAC,qBAAA,GAAnBD,mBAAA,CAAmBF,MAAA,cAAAG,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAnBA,qBAAA,CAAAF,IAAA,CAAAC,mBAA4B,CAAC,CAAA;OAAA,CAAA,CAAA;AAC3D,KAAA;KACC,CAAC3C,OAAA,EAASzC,OAAS,EAAAgC,YAAA,EAAcE,WAAW,CAAC,CAAA,CAAA;AAGhDoB,EAAAA,SAAA,CAAU,YAAM;IACd,IAAI,CAACP,UAAW,CAAAkB,OAAA,EAASlB,UAAA,CAAWkB,UAAUD,aAAc,EAAA,CAAA;AAC5D,IAAA,IAAIvB,OAAS,EAAA;MACXrB,eAAA,KAAA,IAAA,IAAAA,eAAA,KAAAA,KAAAA,CAAAA,IAAAA,eAAA,CAAkB+B,WAAWc,OAAO,CAAA,CAAA;AACtC,KAAA;GACC,EAAA,CAACxB,OAAS,EAAArB,eAAA,EAAiB4C,aAAa,CAAC,CAAA,CAAA;EAE5C,SAASsB,YAAeA,GAAA;IACtB,CAAClF,cAAkB,IAAAyC,YAAA,KAAiBA,YAAa,CAAA0C,KAAA,CAAMC,OAAU,GAAA,MAAA,CAAA,CAAA;AACnE,GAAA;EACA,SAASC,WAAcA,GAAA;IACrB,CAACrF,cAAkB,IAAAyC,YAAA,KAAiBA,YAAa,CAAA0C,KAAA,CAAMC,OAAU,GAAA,OAAA,CAAA,CAAA;AACnE,GAAA;EAEA,SAASE,aAAaC,CAAqC,EAAA;AAC9C7E,IAAAA,QAAA,KAAAA,IAAAA,IAAAA,QAAA,KAAAA,KAAAA,CAAAA,IAAAA,QAAA,CAAA;AAAE6E,MAAAA,GAAAA,CAAAA;AAAE,KAAC,CAAA,CAAA;AAGV,IAAA,IAAAC,sBAAA,GAAyBC,QAAS,CAAA,UAACF,EAAM,EAAA;AAAA,MAAA,OAAA5E,gBAAA,KAAA,IAAA,IAAAA,gBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,gBAAA,CAAmB;AAAE4E,QAAAA,CAAAA,EAAAA,EAAAA;AAAE,OAAC,CAAA,CAAA;AAAA,KAAA,EAAG,GAAG,CAAA,CAAA;AAE7E,IAAA,IAAAG,SAAA,GAAkDH,CAAE,CAAAI,MAAA;MAA5CC,SAAA,GAAAF,SAAA,CAAAE,SAAA;MAAWC,YAAc,GAAAH,SAAA,CAAdG,YAAc;MAAAC,YAAA,GAAAJ,SAAA,CAAAI,YAAA,CAAA;IAEjC,IAAID,YAAe,GAAAE,IAAA,CAAKC,KAAM,CAAAJ,SAAS,MAAME,YAAc,EAAA;MAEzDN,sBAAA,CAAuBD,CAAC,CAAA,CAAA;AAC1B,KAAA;AACF,GAAA;EAGA,SAASU,gBAAgB9F,aAA4C,EAAA;AACnE,IAAA,IAAI4D,UAAUpB,UAAU,CAAA,IAAKE,SAASgB,OAAW,IAAA,OAAO1D,kBAAiB,UAAY,EAAA;AAC5E,MAAA,OAAA6D,aAAA,CAAA,EAAA,EAAK7D,aAAa,CAAA4D,SAAA,CAAUpB,UAAU,CAAG,EAAAE,QAAA,CAASgB,OAAO,CAAE,CAAA,CAAA;AACpE,KAAA;IACO,OAAAG,aAAA,KAAK7D,aAAa,CAAA,CAAA;AAC3B,GAAA;EAEM,IAAA+F,OAAA,GAAU9C,8BACb+C,KAAA,CAAAC,aAAA,CAAAC,aAAA,EAAA;AACCC,IAAAA,MAAM,EAAA,IAAA;AACN,IAAA,IAAA,EAAIjE,OAAA;AACJkE,IAAAA,OAAS,EAAAtD,0BAAA;AACTuD,IAAAA,OAAS,EAAA1D,SAAA;AACT2D,IAAAA,aAAe,EAAAzG,cAAA;AACf0G,IAAAA,OAAS,EAAArB,WAAA;AACTsB,IAAAA,QAAU,EAAAzB,YAAAA;AAAA,GAAA,iBAETiB,KAAA,CAAAC,aAAA,CAAAQ,MAAA,EAAA;AAAOxC,IAAAA,WAAA,EAAaL,UAAUpB,UAAU,CAAA;AAAG7C,IAAAA,MAAQ,EAAAsB,WAAA;AAAa7B,IAAAA,GAAK,EAAAuD,SAAAA;GAAA,iBACnEqD,KAAA,CAAAC,aAAA,CAAAC,aAAA,EAAArC,aAAA,CAAA;AACCsC,IAAAA,MAAM,EAAA,IAAA;AACNC,IAAAA,OAAS,EAAA,CAAA;AACT,IAAA,IAAA,EAAIlE,OAAA;AACJmE,IAAAA,OAAS,EAAA3D,QAAAA;AAAA,GAAA,EACLgE,mBAAoB,CAAA;AACtB1F,IAAAA,WAAA,EAAAA,WAAA;AACA2F,IAAAA,aAAe,EAAArF,QAAA;IACfb,iBAAiBA,eAAmB,IAAAY,UAAAA;GACrC,CAAA,CAED,iBAAC2E,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAApC,aAAA,CAAAA,aAAA,CAAA;AACCzE,IAAAA,GAAA,EAAK,SAALA,GAAAA,CAAMwH,IAAS,EAAA;AACb,MAAA,IAAIA,IAAM,EAAA;QACRlE,QAAA,CAASgB,OAAU,GAAAkD,IAAA,CAAA;QACnBrE,eAAA,CAAgBqE,IAAI,CAAA,CAAA;AACtB,OAAA;KACF;AACA5B,IAAAA,KAAA,EAAAnB,aAAA,CAAAA,aAAA,CAAYE,EAAAA,EAAAA,MAAA,CAAO8C;AAAQvG,MAAAA,MAAQ,EAARA,MAAAA;AAAQ,KAAA,EAAGwF,eAAgB,CAAA9F,YAAY,CAAE,CAAA;AACpE8G,IAAAA,SAAW,EAAAC,UAAA,CAAA,EAAA,CAAAC,MAAA,CAAchG,WAAA,aAAqBlB,gBAAgB,CAAA;AAAA,GAAA,EAC1DkE,UAAW,CAAA6C,MAAA,CAAA,EACXrD,aAAc,EAAA,CAElB,iBAACwC,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;AACC7G,IAAAA,GAAK,EAAAwD,UAAA;AACLkE,IAAAA,SAAW,EAAAC,UAAA,CAAA,EAAA,CAAAC,MAAA,CACNhG,WAAA,EAAAiG,iBAAAA,CAAAA,EAAAA,eAAA,CAAAD,EAAAA,EAAAA,EAAAA,CAAAA,MAAA,CAEGhG,WAAsC,EAAA,wBAAA,CAAA,EAAApB,SAAA,CAAA,EAE5CG,qBACF,CAAA;AACAiF,IAAAA,KAAA,EAAOc,gBAAgB7F,iBAAiB,CAAA;AACxCM,IAAAA,QAAU,EAAA4E,YAAAA;GAET,EAAA1F,OAAA,EACAG,2BAEEoG,KAAA,CAAAC,aAAA,CAAA,KAAA,EAAA;IAAIjB,OAAOjB,MAAO,CAAAmD,KAAA;AAAOJ,IAAAA,qBAAc9F,WAAA,EAAA,eAAA,CAAA;AAA4B,IAAA,mBAAiB,EAAA,IAAA;AAAA,GAAC,CACpF,GAAA,IACN,CACF,CACF,CACF,CACF,CAAA,CAAA;EAGFmG,mBAAA,CAAoB/H,KAAK,YAAA;IAAA,OAAO;MAC9BgI,SAAA,EAAW,SAAXA,SAAAA,GAAA;QAAA,OAAiBvE,SAAU,CAAAa,OAAA,CAAA;AAAA,OAAA;MAC3B2D,eAAA,EAAiB,SAAjBA,eAAAA,GAAA;QAAA,OAAuB3E,QAAS,CAAAgB,OAAA,CAAA;AAAA,OAAA;MAChC4D,gBAAA,EAAkB,SAAlBA,gBAAAA,GAAA;QAAA,OAAwB3E,SAAU,CAAAe,OAAA,CAAA;AAAA,OAAA;MAClC6D,sBAAA,EAAwB,SAAxBA,sBAAAA,GAAA;QAAA,OAA8B3E,UAAW,CAAAc,OAAA,CAAA;AAAA,OAAA;AACzC8D,MAAAA,UAAA,EAAY,SAAZA,UAAAA,CAAatF,QAAqB,EAAA;QAAA,OAAAH,eAAA,CAAgBG,UAAS;AAAE1C,UAAAA,OAAA,EAAS,UAAA;AAAW,SAAC,CAAA,CAAA;AAAA,OAAA;KAClF,CAAA;AAAA,GAAA,CAAA,CAAA;AAEF,EAAA,sBACGwG,KAAA,CAAAC,aAAA,CAAAD,KAAA,CAAMyB,QAAN,EAAA,IAAA,EACExD,aACA8B,OACH,CAAA,CAAA;AAEJ,CAAC,EAAA;AAED9G,KAAA,CAAMyI,WAAc,GAAA,OAAA;;;;"}