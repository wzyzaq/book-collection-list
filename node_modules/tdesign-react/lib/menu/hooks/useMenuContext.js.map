{"version":3,"file":"useMenuContext.js","sources":["../../../../components/menu/hooks/useMenuContext.ts"],"sourcesContent":["import { noop } from 'lodash-es';\nimport { useState, ReactNode } from 'react';\nimport { MenuState, SetMenuState, MenuMode } from '../MenuContext';\nimport checkSubMenuChildExpanded from '../_util/checkSubMenuChildExpanded';\nimport { TdMenuProps, TdHeadMenuProps, MenuValue } from '../type';\n\ninterface UseMenuContextProps extends Extract<TdMenuProps, TdHeadMenuProps> {\n  children: ReactNode;\n  mode: MenuMode;\n}\n\nfunction useMenuContext({\n  defaultValue,\n  defaultExpanded,\n  expandMutex,\n  children,\n  onExpand = noop,\n  onChange = noop,\n  value,\n  expanded,\n  collapsed,\n  expandType,\n  theme,\n  mode,\n}: UseMenuContextProps) {\n  const [state, setState] = useState<MenuState>({\n    active: defaultValue,\n    expanded: defaultExpanded,\n  });\n\n  const setStateValue: SetMenuState = (menuState) => setState({ ...state, ...menuState });\n\n  const handleExpandChange = (value: MenuValue, expanded: MenuValue[]) => {\n    let nextExpand = [];\n    const index = expanded.indexOf(value);\n\n    // 已经展开\n    if (index > -1) {\n      // 互斥情况\n      if (expandMutex) {\n        nextExpand = expanded.slice(0, index);\n      } else {\n        nextExpand = expanded.filter((item) => item !== value);\n      }\n    } else if (expandMutex) {\n      // 未展开\n      nextExpand = checkSubMenuChildExpanded(children, expanded, value);\n    } else {\n      nextExpand = [...expanded, value];\n    }\n    onExpand(nextExpand);\n    setState({ expanded: nextExpand });\n  };\n\n  return {\n    value: {\n      onExpand: handleExpandChange,\n      onChange,\n      active: value || state.active,\n      expanded: expanded || state.expanded,\n      collapsed: collapsed || state.collapsed,\n      setState: setStateValue,\n      expandMutex,\n      expandType: collapsed ? 'popup' : expandType,\n      mode,\n      theme,\n    },\n  };\n}\n\nexport default useMenuContext;\n"],"names":["useMenuContext","_ref","defaultValue","defaultExpanded","expandMutex","children","_ref$onExpand","onExpand","noop","_ref$onChange","onChange","value","expanded","collapsed","expandType","theme","mode","_useState","useState","active","_useState2","_slicedToArray","state","setState","setStateValue","menuState","_objectSpread","handleExpandChange","nextExpand","index","indexOf","slice","filter","item","checkSubMenuChildExpanded","concat","_toConsumableArray"],"mappings":"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"}