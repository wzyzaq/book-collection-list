{"version":3,"file":"TooltipLite.js","sources":["../../../common/js/utils/getPosition.ts","../../../components/tooltip/TooltipLite.tsx"],"sourcesContent":["type Placement = 'top' | 'bottom' | 'left' | 'right' | 'mouse';\n\nconst getPosition = (\n  targetEle: HTMLElement,\n  contentEle: HTMLElement,\n  placement: Partial<Placement>,\n  clientX?: Number,\n  clientY?: Number,\n): { left: number; top: number } => {\n  const targetRect = targetEle.getBoundingClientRect() as DOMRect;\n  const contentRect = contentEle.getBoundingClientRect() as DOMRect;\n\n  const position = {\n    top: document.documentElement.scrollTop,\n    left: document.documentElement.scrollLeft,\n  };\n\n  if (targetRect && contentRect) {\n    const dWidth = targetRect.width - contentRect.width;\n    // eslint-disable-next-line default-case\n    switch (placement) {\n      case 'top':\n        position.left += targetRect.left + dWidth / 2;\n        position.top += targetRect.top - contentRect.height - 16;\n        break;\n      case 'bottom':\n        position.left += targetRect.left + dWidth / 2;\n        position.top += targetRect.top + targetRect.height;\n        break;\n      case 'mouse':\n        position.left += Number(clientX);\n        position.top += typeof clientY !== 'undefined'\n          ? Number(clientY) + 16\n          : targetRect.top + targetRect.height + 8;\n        break;\n      // 后续有需要可以再扩展\n    }\n\n    if (placement === 'mouse') {\n      const edges = {\n        top: document.documentElement.scrollTop,\n        left: document.documentElement.scrollLeft,\n        right: document.documentElement.scrollLeft + document.documentElement.clientWidth,\n        bottom: document.documentElement.scrollTop + document.documentElement.clientHeight,\n      };\n\n      // 底部溢出时，定位到元素上方\n      if (position.top > edges.bottom - contentRect.height) {\n        position.top = document.documentElement.scrollTop + targetRect.top - contentRect.height - 8;\n      }\n\n      // 右侧溢出时，确保元素能完全展示\n      if (position.left > edges.right - contentRect.width) {\n        position.left = edges.right - contentRect.width;\n      }\n    }\n  }\n\n  return position;\n};\n\nexport default getPosition;\n","import React, { ReactNode, useState, useRef, useEffect, useCallback } from 'react';\nimport classnames from 'classnames';\nimport { CSSTransition } from 'react-transition-group';\nimport { throttle } from 'lodash-es';\nimport getPosition from '@tdesign/common-js/utils/getPosition';\nimport { StyledProps } from '../common';\nimport useSwitch from '../hooks/useSwitch';\nimport useAnimation from '../hooks/useAnimation';\nimport Portal from '../common/Portal';\nimport useConfig from '../hooks/useConfig';\nimport { TdTooltipLiteProps } from './type';\nimport { tooltipLiteDefaultProps } from './defaultProps';\nimport { getTransitionParams } from '../popup/utils/transition';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport interface TooltipLiteProps extends TdTooltipLiteProps, StyledProps {\n  children?: ReactNode;\n}\n\nconst DEFAULT_TRANSITION_TIMEOUT = 180;\n\nconst TooltipLite: React.FC<TooltipLiteProps> = (originalProps) => {\n  const props = useDefaultProps<TooltipLiteProps>(originalProps, tooltipLiteDefaultProps);\n  const { style, className, placement, showArrow, theme, children, triggerElement, content, showShadow } = props;\n  const triggerRef = useRef(null);\n  const contentRef = useRef(null);\n  const popupRef = useRef(null);\n  const { classPrefix } = useConfig();\n  const [hover, hoverAction] = useSwitch();\n  const [clientX, setHoverClientX] = useState(0);\n  const [clientY, setHoverClientY] = useState(0);\n  const [position, setPosition] = useState(null);\n  const { keepFade } = useAnimation();\n\n  useEffect(() => {\n    if (triggerRef.current && contentRef.current) {\n      setPosition(getPosition(triggerRef.current, contentRef.current, placement, clientX, clientY));\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [triggerRef.current, contentRef.current, placement, hover, clientX, clientY]);\n\n  const updatePosition = (position: Pick<MouseEvent, 'clientX' | 'clientY'>) => {\n    const { clientX, clientY } = position;\n    setHoverClientX(clientX);\n    setHoverClientY(clientY);\n  };\n\n  const onSwitchHover = (action: String, e: MouseEvent) => {\n    const { clientX, clientY } = e;\n    updatePosition({ clientX, clientY });\n    hoverAction.set(action === 'on');\n  };\n\n  const showTipArrow = showArrow && placement !== 'mouse';\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const onSwitchMove = useCallback(\n    throttle((e) => updatePosition(e), 16.7, { trailing: true }),\n    [],\n  );\n\n  const getTriggerChildren = (children) => {\n    const appendProps = {\n      ref: triggerRef,\n      onMouseMove: (e) => {\n        const { clientX, clientY } = e;\n        return onSwitchMove({ clientX, clientY });\n      },\n      onMouseEnter: (e) => onSwitchHover('on', e),\n      onMouseLeave: (e) => onSwitchHover('off', e),\n    };\n    if (!React.isValidElement(children)) {\n      return React.cloneElement(<div>{children}</div>, { ...appendProps });\n    }\n    return React.cloneElement(children, { ...appendProps });\n  };\n\n  return (\n    <div>\n      {getTriggerChildren(children || triggerElement)}\n      {hover && (\n        <Portal>\n          <CSSTransition\n            appear\n            timeout={{\n              appear: DEFAULT_TRANSITION_TIMEOUT,\n            }}\n            in={hover}\n            nodeRef={popupRef}\n            {...getTransitionParams({\n              classPrefix,\n              fadeAnimation: keepFade,\n            })}\n          >\n            <div\n              className={classnames(\n                `${classPrefix}-popup`,\n                `${classPrefix}-tooltip`,\n                {\n                  [`${classPrefix}-tooltip--${theme}`]: theme,\n                  [`${classPrefix}-tooltip--noshadow`]: !showShadow,\n                },\n                className,\n              )}\n              style={{\n                position: 'absolute',\n                left: position?.left,\n                top: position?.top,\n              }}\n              data-popper-placement={placement}\n              ref={popupRef}\n            >\n              <div\n                className={classnames(`${classPrefix}-popup__content`, {\n                  [`${classPrefix}-popup__content--arrow`]: showTipArrow,\n                })}\n                ref={contentRef}\n                style={style}\n              >\n                {content}\n                {showTipArrow && <div className={`${classPrefix}-popup__arrow`} />}\n              </div>\n            </div>\n          </CSSTransition>\n        </Portal>\n      )}\n    </div>\n  );\n};\n\nTooltipLite.displayName = 'Tooltiplite';\n\nexport default React.memo(TooltipLite);\n"],"names":["getPosition","targetEle","contentEle","placement","clientX","clientY","targetRect","getBoundingClientRect","contentRect","position","top","document","documentElement","scrollTop","left","scrollLeft","dWidth","width","height","Number","edges","right","clientWidth","bottom","clientHeight","DEFAULT_TRANSITION_TIMEOUT","TooltipLite","originalProps","props","useDefaultProps","tooltipLiteDefaultProps","style","className","showArrow","theme","children","triggerElement","content","showShadow","triggerRef","useRef","contentRef","popupRef","_useConfig","useConfig","classPrefix","_useSwitch","useSwitch","_useSwitch2","_slicedToArray","hover","hoverAction","_useState","useState","_useState2","setHoverClientX","_useState3","_useState4","setHoverClientY","_useState5","_useState6","setPosition","_useAnimation","useAnimation","keepFade","useEffect","current","updatePosition","onSwitchHover","action","e","set","showTipArrow","onSwitchMove","useCallback","throttle","trailing","getTriggerChildren","appendProps","ref","onMouseMove","onMouseEnter","onMouseLeave","React","isValidElement","cloneElement","createElement","_objectSpread","Portal","CSSTransition","appear","timeout","nodeRef","getTransitionParams","fadeAnimation","classnames","concat","_defineProperty","displayName","memo"],"mappings":"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"}