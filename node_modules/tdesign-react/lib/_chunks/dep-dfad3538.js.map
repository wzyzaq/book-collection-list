{"version":3,"file":"dep-dfad3538.js","sources":["../../../common/js/color-picker/format.ts","../../../components/color-picker/components/panel/format/inputs.tsx"],"sourcesContent":["import Color from './color';\nimport { ALPHA_FORMAT_MAP, COLOR_FORMAT_INPUTS, FORMATS } from './constants';\nimport type { AlphaConvertibleFormat, BasicColorFormat, ColorFormat } from './types';\n\n/**\n * 兜底处理用户传入的格式，例如：\n * - 传入 `RGB`， 但 `enableAlpha` ，则返回 `RGBA`\n */\nexport const initColorFormat = (format: ColorFormat, enableAlpha: boolean) => {\n  if (enableAlpha && format in ALPHA_FORMAT_MAP) {\n    return format in ALPHA_FORMAT_MAP ? ALPHA_FORMAT_MAP[format as AlphaConvertibleFormat] : format;\n  }\n  return format as BasicColorFormat;\n};\n\n/**\n * 获取不同格式的输入输出值\n * - encode：将字符串转换为单独的颜色值，例如 `{r: 255, g: 255, b: 255}`\n * - decode：获取完整的颜色字符串，例如 `rgb(255, 255, 255)`\n */\nexport const getColorFormatMap = (color: Color, type: 'encode' | 'decode') => {\n  if (type === 'encode') {\n    return {\n      HSV: color.getHsva(),\n      HSVA: color.getHsva(),\n      HSL: color.getHsla(),\n      HSLA: color.getHsla(),\n      RGB: color.getRgba(),\n      RGBA: color.getRgba(),\n      CMYK: color.getCmyk(),\n      CSS: {\n        css: color.css,\n      },\n      HEX: {\n        hex: color.hex,\n      },\n      HEX8: {\n        hex: color.hex8, // 为了减少转换 hex8 的 key 也对应 hex\n      },\n    };\n  }\n\n  // decode\n  return color.getFormatsColorMap();\n};\n\n/**\n * 获取下拉框的格式选项\n */\nexport const getColorFormatOptions = (enableAlpha: boolean) => (\n  enableAlpha\n    ? FORMATS.map((item) => (item in ALPHA_FORMAT_MAP ? ALPHA_FORMAT_MAP[item as AlphaConvertibleFormat] : item))\n    : FORMATS\n);\n\n/**\n * 获取当前格式的输入框配置\n */\nexport const getColorFormatInputs = (\n  format: ColorFormat = 'RGB',\n  enableAlpha: boolean\n) => {\n  let finalFormat;\n\n  /* 为了减少 `ALPHA_FORMAT_MAP` 中的重复代码\n     `RGBA/HEX8/HSLA/HSVA` 会被转换为 `RGB/HEX/HSL/HSV` 后再匹配\n     但在下一步会 push 一个代表透明度的输入框 */\n  if (enableAlpha) {\n    finalFormat = Object.keys(ALPHA_FORMAT_MAP).find(\n      (key) => key in ALPHA_FORMAT_MAP && ALPHA_FORMAT_MAP[key as AlphaConvertibleFormat] === format\n    ) || format;\n  } else {\n    finalFormat = format;\n  }\n\n  if (!COLOR_FORMAT_INPUTS[finalFormat as BasicColorFormat]) return [];\n\n  const configs = [\n    ...(COLOR_FORMAT_INPUTS[finalFormat as BasicColorFormat]),\n  ];\n\n  // CMYK 格式不支持透明度\n  if (enableAlpha && format !== 'CMYK') {\n    configs.push({\n      type: 'inputNumber',\n      key: 'a',\n      min: 0,\n      max: 100,\n      format: (value: number) => `${value}%`,\n      flex: 1.15,\n    });\n  }\n\n  return configs;\n};\n","import React, { useRef, useEffect } from 'react';\nimport { throttle } from 'lodash-es';\nimport { Color, getColorFormatInputs, getColorFormatMap } from '@tdesign/common-js/color-picker/index';\nimport Input from '../../../../input';\nimport InputNumber from '../../../../input-number';\n\nconst FormatInputs = (props) => {\n  const { format, enableAlpha, inputProps, disabled, onInputChange, color } = props;\n  const modelValueRef = useRef({});\n  const lastModelValue = useRef({});\n\n  const updateModelValue = () => {\n    const value = getColorFormatMap(color, 'encode')[format];\n    if (!value) return;\n    value.a = Math.round(color.alpha * 100);\n\n    const changedFormatValue = {};\n    Object.keys(value).forEach((key) => {\n      if (value[key] !== modelValueRef.current[key]) {\n        changedFormatValue[key] = value[key];\n      }\n      lastModelValue.current[key] = value[key];\n    });\n\n    if (Object.keys(changedFormatValue).length > 0) {\n      modelValueRef.current = value;\n    }\n  };\n\n  const handleInputChange = (key: string, v: number | string) => {\n    if (v === lastModelValue.current[key]) return;\n    lastModelValue.current[key] = v;\n\n    const newFormatValue = {\n      ...modelValueRef.current,\n      [key]: v,\n    };\n    modelValueRef.current = newFormatValue;\n\n    // 对应 COLOR_FORMAT_INPUTS 中的 key\n    if (key === 'a') {\n      // 透明通道\n      color.alpha = (v as number) / 100;\n    } else if (key === 'hex' || key === 'css') {\n      // 纯字符串类型的格式\n      color.update(v);\n    } else {\n      // 需要进一步转换的格式\n      color.update(Color.object2color(newFormatValue, format));\n    }\n\n    const value = getColorFormatMap(color, 'decode')[format];\n    onInputChange(value, color.alpha, key, v);\n  };\n\n  updateModelValue();\n  useEffect(() => {\n    const throttleUpdate = throttle(updateModelValue, 100);\n    throttleUpdate();\n    return () => throttleUpdate.cancel();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [color.saturation, color.hue, color.value, color.alpha, format]);\n\n  return (\n    <div className=\"input-group\">\n      {getColorFormatInputs(format, enableAlpha).map((config) => {\n        const commonProps = {\n          ...inputProps,\n          title: modelValueRef.current[config.key],\n          [config.type === 'input' ? 'defaultValue' : 'value']: modelValueRef.current[config.key],\n          align: 'center',\n          disabled,\n          size: 'small',\n          onChange:\n            config.type === 'input'\n              ? Function.prototype\n              : (v: string) => handleInputChange(config.key, v || config.min),\n          onBlur: (v: string) => handleInputChange(config.key, v),\n          onEnter: (v: string) => handleInputChange(config.key, v),\n        };\n\n        return (\n          <div\n            className=\"input-group__item\"\n            key={config.key}\n            style={{\n              flex: config.flex || 1,\n            }}\n          >\n            {config.type === 'input' ? (\n              <Input {...commonProps} key={commonProps.defaultValue} maxlength={format === 'HEX' ? 9 : undefined} />\n            ) : (\n              <InputNumber\n                {...commonProps}\n                min={config.min}\n                max={config.max}\n                step={1}\n                format={config.format}\n                theme=\"normal\"\n              />\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default React.memo(FormatInputs);\n"],"names":["initColorFormat","format","enableAlpha","ALPHA_FORMAT_MAP","getColorFormatMap","color","type","HSV","getHsva","HSVA","HSL","getHsla","HSLA","RGB","getRgba","RGBA","CMYK","getCmyk","CSS","css","HEX","hex","HEX8","hex8","getFormatsColorMap","getColorFormatOptions","FORMATS","map","item","getColorFormatInputs","arguments","length","undefined","finalFormat","Object","keys","find","key","COLOR_FORMAT_INPUTS","configs","_toConsumableArray","push","min","max","value","concat","flex","FormatInputs","props","inputProps","disabled","onInputChange","modelValueRef","useRef","lastModelValue","updateModelValue","a","Math","round","alpha","changedFormatValue","forEach","current","handleInputChange","v","newFormatValue","_objectSpread","_defineProperty","update","Color","object2color","useEffect","throttleUpdate","throttle","cancel","saturation","hue","React","createElement","className","config","commonProps","title","Function","prototype","onBlur","onEnter","style","Input","defaultValue","maxlength","InputNumber","step","theme","memo"],"mappings":"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"}