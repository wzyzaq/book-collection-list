{"version":3,"file":"TreeSelect.js","sources":["../../../components/tree-select/TreeSelect.tsx"],"sourcesContent":["import React, { useCallback, useMemo, useRef, forwardRef, ElementRef, useImperativeHandle } from 'react';\nimport { isFunction } from 'lodash-es';\nimport classNames from 'classnames';\nimport type { TdTreeSelectProps, TreeSelectValue } from './type';\nimport type { StyledProps, TreeOptionData } from '../common';\nimport useConfig from '../hooks/useConfig';\nimport useControlled from '../hooks/useControlled';\nimport Tree from '../tree';\nimport type { TreeInstanceFunctions, TreeProps } from '../tree';\nimport SelectInput, { SelectInputProps } from '../select-input/SelectInput';\nimport { usePersistFn } from '../hooks/usePersistFn';\nimport useSwitch from '../hooks/useSwitch';\nimport noop from '../_util/noop';\nimport { useTreeSelectUtils } from './hooks/useTreeSelectUtils';\nimport { SelectArrow } from './SelectArrow';\nimport { useTreeSelectPassThroughProps } from './hooks/useTreeSelectPassthroughProps';\nimport { useTreeSelectLocale } from './hooks/useTreeSelectLocale';\nimport { treeSelectDefaultProps } from './defaultProps';\nimport parseTNode from '../_util/parseTNode';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport { PopupRef } from '../popup';\nimport { InputRef } from '../input';\n\nexport interface TreeSelectProps<DataOption extends TreeOptionData = TreeOptionData>\n  extends TdTreeSelectProps<DataOption>,\n    StyledProps {}\n\nexport interface NodeOptions {\n  label: string;\n  value: string | number;\n}\n\nconst useMergeFn = <T extends any[]>(...fns: Array<(...args: T) => void>) =>\n  usePersistFn((...args: T) => fns.forEach((fn) => fn?.(...args)));\n\ntype TreeSelectRefType = Partial<ElementRef<typeof Tree> & PopupRef & InputRef>;\n\nconst TreeSelect = forwardRef<TreeSelectRefType, TreeSelectProps>((originalProps, ref) => {\n  const props = useDefaultProps<TreeSelectProps<TreeOptionData>>(originalProps, treeSelectDefaultProps);\n  /* ---------------------------------config---------------------------------------- */\n\n  // 国际化文本初始化\n  const { placeholder, empty, loadingItem } = useTreeSelectLocale(props);\n\n  const { classPrefix } = useConfig();\n\n  /* ---------------------------------state---------------------------------------- */\n\n  const {\n    className,\n    onInputChange,\n    readonly,\n    disabled,\n    multiple,\n    prefixIcon,\n    loading,\n    size,\n    max,\n    data,\n    panelTopContent,\n    panelBottomContent,\n    filter: rawFilter,\n    filterable: rawFilterable,\n    onClear,\n    valueDisplay,\n    treeProps,\n    inputProps,\n    valueType,\n    collapsedItems,\n    onBlur,\n    onFocus,\n    onSearch,\n    onRemove,\n    onEnter,\n  } = props;\n\n  const selectInputProps = useTreeSelectPassThroughProps(props);\n  const [value, onChange] = useControlled(props, 'value', props.onChange);\n  const [popupVisible, setPopupVisible] = useControlled(props, 'popupVisible', props.onPopupVisibleChange);\n  const [hover, hoverAction] = useSwitch();\n  const [filterInput, setFilterInput] = useControlled(props, 'inputValue', onInputChange);\n\n  const treeRef = useRef<TreeInstanceFunctions<TreeOptionData>>(null);\n  const selectInputRef = useRef<Partial<PopupRef & InputRef>>(null);\n\n  const tKeys = useMemo(\n    () => ({\n      value: 'value',\n      label: 'label',\n      children: 'children',\n      ...props.keys,\n    }),\n    [props.keys],\n  );\n\n  const passThroughDefaultStore = useMemo<TreeSelectProps>(\n    () => ({\n      data,\n      treeProps: {\n        keys: tKeys,\n        ...treeProps,\n      },\n      valueType,\n    }),\n    [tKeys, data, treeProps, valueType],\n  );\n\n  const { normalizeValue, formatValue, getNodeItem } = useTreeSelectUtils(passThroughDefaultStore, treeRef);\n\n  useImperativeHandle(ref, () => ({\n    ...(selectInputRef.current || {}),\n    ...(treeRef.current || {}),\n  }));\n\n  /* ---------------------------------computed value---------------------------------------- */\n\n  const defaultFilter = (text: string, option: TreeOptionData) => {\n    if (!text) return true;\n    // 过滤时会有空节点影响判断\n    if (!option.label && !option.value) return false;\n    if (option.label && typeof option.label === 'string') {\n      return option.label.includes(text);\n    }\n    if (option.data.text && typeof option.data.text === 'string') {\n      return option.data.text.includes(text);\n    }\n    return true;\n  };\n\n  // priority of onSearch is higher than props.filter\n  const filter = onSearch ? undefined : rawFilter || defaultFilter;\n  const filterable = rawFilterable || !!props.filter;\n\n  const normalizedValue = useMemo(() => {\n    const calcValue: TreeSelectValue[] = Array.isArray(value) ? value : [value];\n    return calcValue.reduce<NodeOptions[]>((result, value) => {\n      const normalized = normalizeValue(value);\n      typeof normalized.value !== 'undefined' && result.push(normalized);\n      return result;\n    }, []);\n    // data 发生变更时，normalizedValue 也需要更新\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [normalizeValue, value, data]);\n\n  const internalInputValue = useMemo(() => {\n    if (multiple) return normalizedValue;\n    // 可筛选、单选、弹框时内容为过滤值\n    return filterable && popupVisible ? filterInput : normalizedValue[0] || '';\n  }, [multiple, normalizedValue, filterable, popupVisible, filterInput]);\n\n  // @ts-ignore TODO: remove it\n  const normalizedValueDisplay: SelectInputProps['valueDisplay'] = useMemo(() => {\n    if (!valueDisplay) {\n      return;\n    }\n    if (multiple) {\n      return ({ onClose }) =>\n        isFunction(valueDisplay) ? valueDisplay({ value: normalizedValue, onClose }) : valueDisplay;\n    }\n    const displayNode = isFunction(valueDisplay)\n      ? valueDisplay({ value: normalizedValue[0], onClose: noop })\n      : valueDisplay;\n    return normalizedValue.length ? displayNode : '';\n  }, [valueDisplay, multiple, normalizedValue]);\n\n  const internalInputValueDisplay: SelectInputProps['valueDisplay'] = useMemo(() => {\n    // 只有单选且下拉展开时需要隐藏 valueDisplay\n    if (filterable && !multiple && popupVisible) {\n      return undefined;\n    }\n    return normalizedValueDisplay;\n  }, [filterable, popupVisible, multiple, normalizedValueDisplay]);\n\n  const inputPlaceholder = useMemo(() => {\n    // 可筛选、单选、弹框且有值时提示当前值\n    if (filterable && !multiple && popupVisible && normalizedValue.length) {\n      // 设置了 valueDisplay 时，优先展示 valueDisplay\n      const valueDisplayPlaceholder = normalizedValueDisplay;\n      if (typeof valueDisplayPlaceholder === 'string') {\n        return valueDisplayPlaceholder;\n      }\n\n      return typeof normalizedValue[0].label === 'string' ? normalizedValue[0].label : String(normalizedValue[0].value);\n    }\n    return placeholder;\n  }, [filterable, multiple, popupVisible, normalizedValue, placeholder, normalizedValueDisplay]);\n\n  const showLoading = !disabled && loading;\n\n  /* ---------------------------------handler---------------------------------------- */\n\n  const handleFilter = useCallback<TreeProps['filter']>(\n    (node) => (filterable && filter ? filter(filterInput as string, node) : true),\n    [filter, filterInput, filterable],\n  );\n\n  const handleSingleChange = usePersistFn<TreeProps['onActive']>((value, context) => {\n    const $value = Array.isArray(value) && value.length ? value[0] : undefined;\n    onChange(formatValue($value, context.node.label), {\n      ...context,\n      data: context.node.data,\n      trigger: 'check',\n    });\n    // 单选选择后收起弹框\n    setPopupVisible(false, { ...context, trigger: 'trigger-element-click' });\n  });\n\n  const handleMultiChange = usePersistFn<TreeProps['onChange']>((value, context) => {\n    if (max === 0 || value.length <= max) {\n      onChange(\n        value.map((value) => formatValue(value, getNodeItem(value)?.label)),\n        {\n          ...context,\n          data: context.node.data,\n          trigger: value.length > normalizedValue.length ? 'check' : 'uncheck',\n        },\n      );\n    }\n  });\n\n  const onInnerPopupVisibleChange: SelectInputProps['onPopupVisibleChange'] = (visible, ctx) => {\n    setPopupVisible(visible, { e: ctx.e });\n  };\n\n  const handleClear = usePersistFn<SelectInputProps['onClear']>((ctx) => {\n    ctx.e.stopPropagation();\n    onChange(multiple ? [] : formatValue(undefined), {\n      node: null,\n      data: null,\n      trigger: 'clear',\n      e: ctx.e as React.MouseEvent<any, any>,\n    });\n    onClear?.(ctx);\n    // 清空后收起弹框\n    setPopupVisible(false, { trigger: 'clear' });\n  });\n\n  const handleTagChange = usePersistFn<SelectInputProps['onTagChange']>((tags, ctx) => {\n    if (ctx.trigger === 'tag-remove' || ctx.trigger === 'backspace') {\n      const { index, e, trigger } = ctx;\n      const node = getNodeItem(normalizedValue[index].value);\n      onChange(\n        normalizedValue.filter((value, i) => i !== index).map(({ value, label }) => formatValue(value, label)),\n        { node, data: node.data, trigger, e },\n      );\n      onRemove?.({\n        value: node.value,\n        node,\n        index,\n        data: { value: node.value, label: node.label, ...node.data },\n        e,\n        trigger,\n      });\n    }\n  });\n\n  const getTreeSelectEventValue = () => {\n    const selectedOptions = Array.isArray(normalizedValue) ? normalizedValue : [normalizedValue];\n    const value = selectedOptions.map((item) => (valueType === 'object' ? item : item[tKeys.value]));\n    return multiple ? value : value[0];\n  };\n\n  const handleBlur = usePersistFn<SelectInputProps['onBlur']>((_, ctx) => {\n    onBlur?.({ value: getTreeSelectEventValue(), ...ctx });\n  });\n\n  const handleFocus = usePersistFn<SelectInputProps['onFocus']>((_, ctx) => {\n    onFocus?.({ value: getTreeSelectEventValue(), e: ctx.e });\n  });\n\n  const handleEnter = usePersistFn<SelectInputProps['onEnter']>((_, ctx) => {\n    onSearch?.(ctx.inputValue, { e: ctx.e });\n    onEnter?.({ inputValue: ctx.inputValue, e: ctx.e, value: getTreeSelectEventValue() });\n  });\n\n  const handleFilterChange = usePersistFn<SelectInputProps['onInputChange']>((value, ctx) => {\n    if (ctx.trigger === 'clear') return;\n\n    setFilterInput(value, ctx);\n    onSearch?.(value, { e: ctx.e });\n  });\n\n  /* ---------------------------------render---------------------------------------- */\n\n  const renderTree = () => {\n    if (readonly) return empty;\n    if (showLoading) return loadingItem;\n    return (\n      <>\n        {panelTopContent}\n        <Tree\n          ref={treeRef}\n          hover\n          transition\n          filter={filterInput ? handleFilter : null}\n          data={data}\n          disabled={disabled}\n          empty={empty}\n          expandOnClickNode={false}\n          allowFoldNodeOnFilter\n          keys={tKeys}\n          {...(multiple\n            ? {\n                checkable: true,\n                onChange: handleMultiChange,\n                value: normalizedValue.map(({ value }) => value),\n              }\n            : {\n                activable: true,\n                actived: normalizedValue.map(({ value }) => value),\n                onActive: handleSingleChange,\n              })}\n          {...treeProps}\n        />\n        {panelBottomContent}\n      </>\n    );\n  };\n\n  return (\n    <SelectInput\n      status={props.status}\n      tips={props.tips}\n      {...props.selectInputProps}\n      {...selectInputProps}\n      ref={selectInputRef}\n      className={classNames(`${classPrefix}-tree-select`, className)}\n      value={internalInputValue}\n      inputValue={filterInput}\n      panel={renderTree()}\n      allowInput={filterable}\n      inputProps={{ ...inputProps, size }}\n      tagInputProps={{ size, excessTagsDisplayType: 'break-line', inputProps, tagProps: props.tagProps }}\n      placeholder={inputPlaceholder}\n      popupVisible={popupVisible && !disabled}\n      onInputChange={handleFilterChange}\n      onPopupVisibleChange={onInnerPopupVisibleChange}\n      onFocus={useMergeFn(handleFocus)}\n      onBlur={useMergeFn(handleBlur)}\n      onClear={handleClear}\n      onTagChange={handleTagChange}\n      onEnter={handleEnter}\n      onMouseenter={hoverAction.on}\n      onMouseleave={hoverAction.off}\n      suffixIcon={\n        props.suffixIcon ||\n        (readonly ? null : (\n          <SelectArrow isActive={popupVisible} isHighlight={hover || popupVisible} disabled={disabled} />\n        ))\n      }\n      collapsedItems={collapsedItems}\n      label={parseTNode(prefixIcon)}\n      valueDisplay={internalInputValueDisplay}\n    />\n  );\n});\n\nTreeSelect.displayName = 'TreeSelect';\n\nexport default TreeSelect;\n"],"names":["useMergeFn","_len","arguments","length","fns","Array","_key","usePersistFn","_len2","args","_key2","forEach","fn","apply","TreeSelect","forwardRef","originalProps","ref","props","useDefaultProps","treeSelectDefaultProps","_useTreeSelectLocale","useTreeSelectLocale","placeholder","empty","loadingItem","_useConfig","useConfig","classPrefix","className","onInputChange","readonly","disabled","multiple","prefixIcon","loading","size","max","data","panelTopContent","panelBottomContent","rawFilter","filter","rawFilterable","filterable","onClear","valueDisplay","treeProps","inputProps","valueType","collapsedItems","onBlur","onFocus","onSearch","onRemove","onEnter","selectInputProps","useTreeSelectPassThroughProps","_useControlled","useControlled","onChange","_useControlled2","_slicedToArray","value","_useControlled3","onPopupVisibleChange","_useControlled4","popupVisible","setPopupVisible","_useSwitch","useSwitch","_useSwitch2","hover","hoverAction","_useControlled5","_useControlled6","filterInput","setFilterInput","treeRef","useRef","selectInputRef","tKeys","useMemo","_objectSpread","label","children","keys","passThroughDefaultStore","_useTreeSelectUtils","useTreeSelectUtils","normalizeValue","formatValue","getNodeItem","useImperativeHandle","current","defaultFilter","text","option","includes","normalizedValue","calcValue","isArray","reduce","result","normalized","push","internalInputValue","normalizedValueDisplay","_ref","onClose","isFunction","displayNode","noop","internalInputValueDisplay","inputPlaceholder","valueDisplayPlaceholder","String","showLoading","handleFilter","useCallback","node","handleSingleChange","context","$value","trigger","handleMultiChange","map","_getNodeItem","onInnerPopupVisibleChange","visible","ctx","e","handleClear","stopPropagation","handleTagChange","tags","index","i","_ref2","getTreeSelectEventValue","selectedOptions","item","handleBlur","_","handleFocus","handleEnter","inputValue","handleFilterChange","renderTree","React","createElement","Fragment","Tree","transition","expandOnClickNode","allowFoldNodeOnFilter","checkable","_ref3","activable","actived","_ref4","onActive","SelectInput","status","tips","classNames","concat","panel","allowInput","tagInputProps","excessTagsDisplayType","tagProps","onTagChange","onMouseenter","on","onMouseleave","off","suffixIcon","SelectArrow","isActive","isHighlight","parseTNode","displayName"],"mappings":"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"}