{"version":3,"file":"List.js","sources":["../../../components/list/List.tsx"],"sourcesContent":["import React, { MouseEvent, useImperativeHandle, useMemo, useRef, WheelEvent } from 'react';\nimport classNames from 'classnames';\nimport { isString } from 'lodash-es';\nimport useConfig from '../hooks/useConfig';\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport noop from '../_util/noop';\nimport { TdListProps } from './type';\nimport { ComponentScrollToElementParams, StyledProps } from '../common';\nimport Loading from '../loading';\nimport ListItem from './ListItem';\nimport ListItemMeta from './ListItemMeta';\nimport { listDefaultProps } from './defaultProps';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport { useListVirtualScroll } from './hooks/useListVirtualScroll';\nimport parseTNode from '../_util/parseTNode';\n\nexport interface ListProps extends TdListProps, StyledProps {\n  /**\n   * 文本内容\n   */\n  children?: React.ReactNode;\n}\n\nexport type ListRef = {\n  scrollTo: (params: ComponentScrollToElementParams) => void;\n};\n\n/**\n * 列表组件\n */\nconst List = forwardRefWithStatics(\n  (props: ListProps, ref: React.Ref<ListRef>) => {\n    const {\n      header,\n      footer,\n      asyncLoading,\n      size,\n      split,\n      stripe,\n      layout,\n      children,\n      className,\n      onLoadMore = noop,\n      onScroll = noop,\n      style,\n      scroll,\n    } = useDefaultProps<ListProps>(props, listDefaultProps);\n    const wrapperRef = useRef<HTMLDivElement>(null);\n\n    const { classPrefix } = useConfig();\n    const [local, t] = useLocaleReceiver('list');\n\n    const listItems = useMemo(\n      () => React.Children.map(children, (child: React.ReactElement) => child.props) ?? [],\n      [children],\n    );\n\n    const { virtualConfig, cursorStyle, listStyle, isVirtualScroll, onInnerVirtualScroll, scrollToElement } =\n      useListVirtualScroll(scroll, wrapperRef, listItems);\n\n    const COMPONENT_NAME = `${classPrefix}-list`;\n\n    const handleClickLoad = (e: MouseEvent<HTMLDivElement>) => {\n      if (asyncLoading === 'load-more') {\n        onLoadMore({ e });\n      }\n    };\n\n    const handleScroll = (event: WheelEvent<HTMLDivElement>): void => {\n      const { currentTarget } = event;\n      const { scrollTop, offsetHeight, scrollHeight } = currentTarget;\n      const scrollBottom = scrollHeight - scrollTop - offsetHeight;\n      if (isVirtualScroll) onInnerVirtualScroll(event as unknown as globalThis.WheelEvent);\n      onScroll({ e: event, scrollTop, scrollBottom });\n    };\n\n    const loadElement = isString(asyncLoading) ? (\n      <div\n        className={classNames(`${classPrefix}-list__load`, {\n          [`${classPrefix}-list__load--loading`]: asyncLoading === 'loading',\n          [`${classPrefix}-list__load--load-more`]: asyncLoading === 'load-more',\n        })}\n        onClick={handleClickLoad}\n      >\n        {asyncLoading === 'loading' && (\n          <div>\n            <Loading loading={true} />\n            <span>{t(local.loadingText)}</span>\n          </div>\n        )}\n        {asyncLoading === 'load-more' && <span>{t(local.loadingMoreText)}</span>}\n      </div>\n    ) : (\n      asyncLoading\n    );\n\n    useImperativeHandle(ref, () => ({\n      scrollTo: scrollToElement,\n    }));\n\n    const renderContent = () => (\n      <>\n        {isVirtualScroll ? (\n          <>\n            <div style={cursorStyle}></div>\n            <ul className={`${COMPONENT_NAME}__inner`} style={listStyle}>\n              {virtualConfig.visibleData.map((item, index) => (\n                <ListItem key={index} content={item.children}></ListItem>\n              ))}\n            </ul>\n          </>\n        ) : (\n          <ul className={`${COMPONENT_NAME}__inner`}>{children}</ul>\n        )}\n      </>\n    );\n\n    return (\n      <div\n        ref={wrapperRef}\n        style={{\n          ...style,\n          position: isVirtualScroll ? 'relative' : undefined,\n        }}\n        onScroll={handleScroll}\n        className={classNames(`${COMPONENT_NAME}`, className, {\n          [`${COMPONENT_NAME}--split`]: split,\n          [`${COMPONENT_NAME}--stripe`]: stripe,\n          [`${COMPONENT_NAME}--vertical-action`]: layout === 'vertical',\n          [`${classPrefix}-size-s`]: size === 'small',\n          [`${classPrefix}-size-l`]: size === 'large',\n        })}\n      >\n        {header && <div className={`${COMPONENT_NAME}__header`}>{parseTNode(header)}</div>}\n        {renderContent()}\n        {asyncLoading && loadElement}\n        {footer && <div className={`${COMPONENT_NAME}__footer`}>{parseTNode(footer)}</div>}\n      </div>\n    );\n  },\n  { ListItem, ListItemMeta },\n);\n\nList.displayName = 'List';\n\nexport default List;\n"],"names":["List","forwardRefWithStatics","props","ref","_useDefaultProps","useDefaultProps","listDefaultProps","header","footer","asyncLoading","size","split","stripe","layout","children","className","_useDefaultProps$onLo","onLoadMore","noop","_useDefaultProps$onSc","onScroll","style","scroll","wrapperRef","useRef","_useConfig","useConfig","classPrefix","_useLocaleReceiver","useLocaleReceiver","_useLocaleReceiver2","_slicedToArray","local","t","listItems","useMemo","_React$Children$map","React","Children","map","child","_useListVirtualScroll","useListVirtualScroll","virtualConfig","cursorStyle","listStyle","isVirtualScroll","onInnerVirtualScroll","scrollToElement","COMPONENT_NAME","handleClickLoad","e","handleScroll","event","currentTarget","scrollTop","offsetHeight","scrollHeight","scrollBottom","loadElement","isString","createElement","classNames","concat","_defineProperty","onClick","Loading","loading","loadingText","loadingMoreText","useImperativeHandle","scrollTo","renderContent","Fragment","visibleData","item","index","ListItem","key","content","_objectSpread","position","parseTNode","ListItemMeta","displayName"],"mappings":"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"}