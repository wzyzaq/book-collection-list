{"version":3,"file":"dom.js","sources":["../../../../components/anchor/_util/dom.ts"],"sourcesContent":["import raf from 'raf';\nimport { easeInOutCubic, EasingFunction } from '../../_util/easing';\n\nexport type AnchorContainer = HTMLElement | Window;\n\nexport function getOffsetTop(target: HTMLElement, container: AnchorContainer) {\n  const { top } = target.getBoundingClientRect();\n  if (container === window) {\n    // 减去 document 的边框\n    return top - document.documentElement.clientTop;\n  }\n  return top - (container as HTMLElement).getBoundingClientRect().top;\n}\n\n/**\n * 返回是否 window 对象\n *\n * @export\n * @param {any} obj\n * @returns\n */\nfunction isWindow(obj: any) {\n  return obj && obj === obj.window;\n}\n\ntype ScrollTarget = HTMLElement | Window | Document;\n\n/**\n * 获取滚动距离\n *\n * @export\n * @param {ScrollTarget} target\n * @param {boolean} isLeft true为获取scrollLeft, false为获取scrollTop\n * @returns {number}\n */\nexport function getScroll(target: ScrollTarget, isLeft?: boolean): number {\n  // node 环境或者 target 为空\n  if (typeof window === 'undefined' || !target) {\n    return 0;\n  }\n  const method = isLeft ? 'scrollLeft' : 'scrollTop';\n  let result = 0;\n  if (isWindow(target)) {\n    result = (target as Window)[isLeft ? 'pageXOffset' : 'pageYOffset'];\n  } else if (target instanceof Document) {\n    result = target.documentElement[method];\n  } else if (target) {\n    result = (target as HTMLElement)[method];\n  }\n  return result;\n}\n\ninterface ScrollTopOptions {\n  container?: ScrollTarget;\n  duration?: number;\n  easing?: EasingFunction;\n}\nexport function scrollTo(target: number, opt: ScrollTopOptions) {\n  const { container = window, duration = 450, easing = easeInOutCubic } = opt;\n  const scrollTop = getScroll(container);\n  const startTime = Date.now();\n  return new Promise((res) => {\n    const fnc = () => {\n      const timestamp = Date.now();\n      const time = timestamp - startTime;\n      const nextScrollTop = easing(Math.min(time, duration), scrollTop, target, duration);\n      if (isWindow(container)) {\n        (container as Window).scrollTo(window.pageXOffset, nextScrollTop);\n      } else if (container instanceof HTMLDocument || container.constructor.name === 'HTMLDocument') {\n        (container as HTMLDocument).documentElement.scrollTop = nextScrollTop;\n      } else {\n        (container as HTMLElement).scrollTop = nextScrollTop;\n      }\n      if (time < duration) {\n        raf(fnc);\n      } else {\n        // 由于上面步骤设置了 scrollTop, 滚动事件可能未触发完毕\n        // 此时应该在下一帧再执行 res\n        raf(res);\n      }\n    };\n    raf(fnc);\n  });\n}\n"],"names":["getOffsetTop","target","container","_target$getBoundingCl","getBoundingClientRect","top","window","document","documentElement","clientTop","isWindow","obj","getScroll","isLeft","method","result","Document","scrollTo","opt","_opt$container","_opt$duration","duration","_opt$easing","easing","easeInOutCubic","scrollTop","startTime","Date","now","Promise","res","fnc","timestamp","time","nextScrollTop","Math","min","pageXOffset","HTMLDocument","constructor","name","raf"],"mappings":"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"}