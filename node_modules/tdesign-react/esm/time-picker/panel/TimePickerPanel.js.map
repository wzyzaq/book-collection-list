{"version":3,"file":"TimePickerPanel.js","sources":["../../../../components/time-picker/panel/TimePickerPanel.tsx"],"sourcesContent":["import React, { FC, useEffect, useMemo, useState, useCallback } from 'react';\nimport dayjs from 'dayjs';\nimport { DEFAULT_STEPS, DEFAULT_FORMAT } from '@tdesign/common-js/time-picker/const';\nimport log from '@tdesign/common-js/log/index';\nimport SinglePanel, { SinglePanelProps } from './SinglePanel';\n\nimport useConfig from '../../hooks/useConfig';\nimport Button from '../../button';\n\nimport { useTimePickerTextConfig } from '../hooks/useTimePickerTextConfig';\nimport type { TimePickerProps } from '../TimePicker';\nimport type { TimeRangePickerProps } from '../TimeRangePicker';\n\nexport interface TimePickerPanelProps extends SinglePanelProps {\n  isShowPanel?: boolean;\n  isFooterDisplay?: boolean; // 是否展示footer\n  handleConfirmClick?: (defaultValue: dayjs.Dayjs | string) => void;\n  presets?: TimePickerProps['presets'] | TimeRangePickerProps['presets'];\n  activeIndex?: number;\n}\n\ntype PresetValue = TimePickerPanelProps['presets'][keyof TimePickerPanelProps['presets']];\n\nconst TimePickerPanel: FC<TimePickerPanelProps> = (props) => {\n  const {\n    format = DEFAULT_FORMAT,\n    steps = DEFAULT_STEPS,\n    handleConfirmClick,\n    isFooterDisplay,\n    onChange,\n    value,\n    isShowPanel = true,\n    presets = null,\n  } = props;\n  const [triggerScroll, toggleTriggerScroll] = useState(false); // 触发滚动\n  const { classPrefix } = useConfig();\n\n  const TEXT_CONFIG = useTimePickerTextConfig();\n\n  const panelClassName = `${classPrefix}-time-picker__panel`;\n  const showNowTimeBtn = !!steps.filter((v) => Number(v) > 1).length;\n\n  const defaultValue = useMemo(() => {\n    const formattedValue = dayjs(value, format);\n    if (value && formattedValue.isValid()) {\n      return formattedValue.format(format);\n    }\n\n    return dayjs().hour(0).minute(0).second(0).format(format);\n  }, [value, format]);\n\n  useEffect(() => {\n    if (isShowPanel) toggleTriggerScroll(true);\n  }, [isShowPanel]);\n\n  const resetTriggerScroll = useCallback(() => {\n    toggleTriggerScroll(false);\n  }, [toggleTriggerScroll]);\n\n  const handlePresetClick = (presetValue: PresetValue) => {\n    const presetVal = typeof presetValue === 'function' ? presetValue() : presetValue;\n    if (typeof props.activeIndex === 'number') {\n      if (Array.isArray(presetVal)) {\n        props.onChange?.(presetVal[props.activeIndex]);\n      } else {\n        log.error('TimePicker', `preset: ${presets} 预设值必须是数组!`);\n      }\n    } else {\n      props.onChange?.(presetVal);\n    }\n  };\n\n  const renderFooter = () => {\n    if (presets) {\n      return Object.keys(presets).map((preset) => (\n        <Button\n          key={preset}\n          theme=\"primary\"\n          size=\"small\"\n          variant=\"text\"\n          onClick={() => {\n            handlePresetClick(presets[preset]);\n          }}\n        >\n          {preset}\n        </Button>\n      ));\n    }\n\n    return !showNowTimeBtn ? (\n      <Button\n        theme=\"primary\"\n        variant=\"text\"\n        size=\"small\"\n        onClick={() => {\n          onChange?.(dayjs().format(format));\n        }}\n      >\n        {TEXT_CONFIG.nowTime}\n      </Button>\n    ) : null;\n  };\n\n  return (\n    <div className={panelClassName}>\n      <div className={`${panelClassName}-section-body`}>\n        <SinglePanel\n          {...props}\n          onChange={onChange}\n          format={format}\n          steps={steps}\n          value={dayjs(value, format).isValid() ? value : defaultValue}\n          triggerScroll={triggerScroll}\n          isVisible={isShowPanel}\n          resetTriggerScroll={resetTriggerScroll}\n        />\n      </div>\n      {isFooterDisplay ? (\n        <div className={`${panelClassName}-section-footer`}>\n          <Button\n            size=\"small\"\n            theme=\"primary\"\n            variant=\"base\"\n            disabled={!props.value}\n            onClick={() => {\n              handleConfirmClick?.(defaultValue);\n            }}\n          >\n            {TEXT_CONFIG.confirm}\n          </Button>\n          {renderFooter()}\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\nexport default TimePickerPanel;\n"],"names":["TimePickerPanel","props","_props$format","format","DEFAULT_FORMAT","_props$steps","steps","DEFAULT_STEPS","handleConfirmClick","isFooterDisplay","onChange","value","_props$isShowPanel","isShowPanel","_props$presets","presets","_useState","useState","_useState2","_slicedToArray","triggerScroll","toggleTriggerScroll","_useConfig","useConfig","classPrefix","TEXT_CONFIG","useTimePickerTextConfig","panelClassName","showNowTimeBtn","filter","v","Number","length","defaultValue","useMemo","formattedValue","dayjs","isValid","hour","minute","second","useEffect","resetTriggerScroll","useCallback","handlePresetClick","presetValue","presetVal","activeIndex","Array","isArray","_props$onChange","call","log","error","concat","_props$onChange2","renderFooter","Object","keys","map","preset","React","createElement","Button","key","theme","size","variant","onClick","nowTime","className","SinglePanel","_objectSpread","isVisible","disabled","confirm"],"mappings":"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"}