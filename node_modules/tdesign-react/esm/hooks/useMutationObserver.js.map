{"version":3,"file":"useMutationObserver.js","sources":["../../../components/hooks/useMutationObserver.ts"],"sourcesContent":["import { useRef, useEffect } from 'react';\nimport { debounce, isEqual } from 'lodash-es';\nimport useLatest from './useLatest';\n\nconst DEFAULT_OPTIONS = {\n  debounceTime: 0,\n  config: {\n    attributes: true,\n    childList: true,\n    characterData: true,\n    subtree: true,\n  } as MutationObserverInit,\n};\n\ntype Options = typeof DEFAULT_OPTIONS;\n\nexport default function useMutationObservable(\n  targetEl: HTMLElement | null,\n  cb: MutationCallback,\n  options = DEFAULT_OPTIONS,\n) {\n  const observeRef = useRef(null);\n  const optionsRef = useRef<Options>(null);\n  const signalRen = useRef(0);\n  const callbackRef = useLatest(cb);\n\n  if (!isEqual(options, optionsRef.current)) {\n    signalRen.current += 1;\n  }\n\n  optionsRef.current = options;\n\n  useEffect(() => {\n    if (!targetEl || !targetEl?.nodeType) return;\n\n    try {\n      const { debounceTime, config } = optionsRef.current;\n      const mutationCallback: MutationCallback = (...args) => {\n        callbackRef.current(...args);\n      };\n      observeRef.current = new MutationObserver(\n        debounceTime > 0 ? debounce(mutationCallback, debounceTime) : mutationCallback,\n      );\n      observeRef.current.observe(targetEl, config);\n    } catch (e) {\n      console.error(e);\n    }\n\n    return () => {\n      if (observeRef.current) {\n        observeRef.current.disconnect();\n        observeRef.current = null;\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [targetEl, signalRen.current]);\n}\n"],"names":["DEFAULT_OPTIONS","debounceTime","config","attributes","childList","characterData","subtree","useMutationObservable","targetEl","cb","options","arguments","length","undefined","observeRef","useRef","optionsRef","signalRen","callbackRef","useLatest","isEqual","current","useEffect","nodeType","_optionsRef$current","mutationCallback","apply","MutationObserver","debounce","observe","e","console","error","disconnect"],"mappings":";;;;;;;;;;AAIA,IAAMA,eAAkB,GAAA;AACtBC,EAAAA,YAAc,EAAA,CAAA;AACdC,EAAAA,MAAQ,EAAA;AACNC,IAAAA,UAAY,EAAA,IAAA;AACZC,IAAAA,SAAW,EAAA,IAAA;AACXC,IAAAA,aAAe,EAAA,IAAA;AACfC,IAAAA,OAAS,EAAA,IAAA;AACX,GAAA;AACF,CAAA,CAAA;AAIA,SAAwBC,qBACtBA,CAAAC,QAAA,EACAC,EACA,EACA;AAAA,EAAA,IADAC,OAAA,GAAAC,SAAA,CAAAC,MAAA,GAAA,CAAA,IAAAD,SAAA,CAAA,CAAA,CAAA,KAAAE,SAAA,GAAAF,SAAA,CAAA,CAAA,CAAA,GAAUX,eACV,CAAA;AACM,EAAA,IAAAc,UAAA,GAAaC,OAAO,IAAI,CAAA,CAAA;AACxB,EAAA,IAAAC,UAAA,GAAaD,OAAgB,IAAI,CAAA,CAAA;AACjC,EAAA,IAAAE,SAAA,GAAYF,OAAO,CAAC,CAAA,CAAA;AACpB,EAAA,IAAAG,WAAA,GAAcC,UAAUV,EAAE,CAAA,CAAA;EAEhC,IAAI,CAACW,OAAA,CAAQV,OAAS,EAAAM,UAAA,CAAWK,OAAO,CAAG,EAAA;IACzCJ,SAAA,CAAUI,OAAW,IAAA,CAAA,CAAA;AACvB,GAAA;EAEAL,UAAA,CAAWK,OAAU,GAAAX,OAAA,CAAA;AAErBY,EAAAA,SAAA,CAAU,YAAM;IACV,IAAA,CAACd,QAAY,IAAA,EAACA,QAAU,KAAVA,IAAAA,IAAAA,QAAU,KAAVA,KAAAA,CAAAA,IAAAA,QAAU,CAAAe,QAAA,CAAU,EAAA,OAAA;IAElC,IAAA;AACF,MAAA,IAAAC,mBAAA,GAAiCR,UAAW,CAAAK,OAAA;QAApCpB,YAAA,GAAAuB,mBAAA,CAAAvB,YAAA;QAAcC,MAAO,GAAAsB,mBAAA,CAAPtB,MAAO,CAAA;AACvB,MAAA,IAAAuB,gBAAA,GAAqC,SAArCA,gBAAAA,GAAkD;QAC1CP,WAAA,CAAAG,OAAA,CAAAK,KAAA,CAAAR,WAAA,EAAAP,SAAe,CAAA,CAAA;OAC7B,CAAA;AACAG,MAAAA,UAAA,CAAWO,UAAU,IAAIM,gBAAA,CACvB1B,YAAe,GAAA,CAAA,GAAI2B,QAAS,CAAAH,gBAAA,EAAkBxB,YAAY,CAAI,GAAAwB,gBAChE,CAAA,CAAA;MACWX,UAAA,CAAAO,OAAA,CAAQQ,OAAQ,CAAArB,QAAA,EAAUN,MAAM,CAAA,CAAA;aACpC4B,CAAP,EAAA;AACAC,MAAAA,OAAA,CAAQC,MAAMF,CAAC,CAAA,CAAA;AACjB,KAAA;AAEA,IAAA,OAAO,YAAM;MACX,IAAIhB,WAAWO,OAAS,EAAA;AACtBP,QAAAA,UAAA,CAAWO,QAAQY,UAAW,EAAA,CAAA;QAC9BnB,UAAA,CAAWO,OAAU,GAAA,IAAA,CAAA;AACvB,OAAA;KACF,CAAA;GAEC,EAAA,CAACb,QAAU,EAAAS,SAAA,CAAUI,OAAO,CAAC,CAAA,CAAA;AAClC;;;;"}