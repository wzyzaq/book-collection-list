{"version":3,"file":"Tabs.js","sources":["../../../components/tabs/Tabs.tsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport classNames from 'classnames';\nimport { TabValue, TdTabsProps } from './type';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport TabNav from './TabNav';\nimport { useTabClass } from './useTabClass';\nimport TabPanel from './TabPanel';\nimport { StyledProps } from '../common';\nimport { tabsDefaultProps } from './defaultProps';\nimport useDragSorter from '../hooks/useDragSorter';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport interface TabsProps extends TdTabsProps, StyledProps {\n  children?: React.ReactNode;\n}\n\nconst Tabs = forwardRefWithStatics(\n  (originalProps: TabsProps, ref: React.Ref<HTMLDivElement>) => {\n    const props = useDefaultProps<TabsProps>(originalProps, tabsDefaultProps);\n    const {\n      defaultValue,\n      children,\n      list,\n      placement,\n      value: tabValue,\n      dragSort,\n      className,\n      style,\n      onRemove,\n      onChange,\n    } = props;\n\n    // 样式工具引入\n    const { tdTabsClassPrefix, tdTabsClassGenerator, tdClassGenerator } = useTabClass();\n    const targetClassNameRegExpStr = `^${tdTabsClassPrefix}(__nav-item|__nav-item-wrapper|__nav-item-text-wrapper)`;\n\n    const { getDragProps } = useDragSorter({\n      ...props,\n      sortOnDraggable: dragSort,\n      onDragOverCheck: {\n        x: true,\n        targetClassNameRegExp: new RegExp(targetClassNameRegExpStr),\n      },\n    });\n\n    const memoChildren = React.useMemo<React.ReactNode | React.ReactNode[]>(() => {\n      if (!list || list.length === 0) {\n        return children;\n      }\n      return list.map<React.ReactNode>((panelProps) => <TabPanel key={panelProps.value} {...panelProps} />);\n    }, [children, list]);\n\n    const itemList = React.Children.map(memoChildren, (child: React.ReactElement<any>) => {\n      if (child && child.type === TabPanel) {\n        return child.props;\n      }\n      return null;\n    });\n\n    // 当未设置默认值时，默认选中第一个。\n    const [value, setValue] = React.useState<TabValue>(() =>\n      defaultValue === undefined && Array.isArray(itemList) && itemList.length !== 0 ? itemList[0].value : defaultValue,\n    );\n\n    useEffect(() => {\n      if (tabValue !== undefined) {\n        setValue(tabValue);\n      }\n    }, [tabValue]);\n\n    const handleChange = React.useCallback(\n      (v: TabValue) => {\n        if (tabValue === undefined) {\n          setValue(v);\n        }\n        onChange?.(v);\n      },\n      [tabValue, onChange],\n    );\n\n    const handleClickTab = React.useCallback(\n      (v: TabValue) => {\n        if (tabValue === undefined) {\n          setValue(v);\n        }\n      },\n      [tabValue],\n    );\n\n    const headerNode = React.useMemo<React.ReactNode>(\n      () => (\n        <div className={classNames(tdTabsClassGenerator('header'), tdClassGenerator(`is-${placement}`))}>\n          <TabNav\n            {...props}\n            getDragProps={getDragProps}\n            activeValue={value}\n            onRemove={onRemove}\n            itemList={itemList}\n            tabClick={handleClickTab}\n            onChange={handleChange}\n          />\n        </div>\n      ),\n      [\n        props,\n        getDragProps,\n        value,\n        onRemove,\n        itemList,\n        handleClickTab,\n        handleChange,\n        placement,\n        tdTabsClassGenerator,\n        tdClassGenerator,\n      ],\n    );\n\n    return (\n      <div ref={ref} className={classNames(tdTabsClassPrefix, className)} style={style}>\n        {placement !== 'bottom' ? headerNode : null}\n        <div className={classNames(tdTabsClassGenerator('content'), tdClassGenerator(`is-${placement}`))}>\n          {React.Children.map(memoChildren, (child: any) => {\n            if (child && child.type === TabPanel) {\n              return <TabPanel {...child.props} isActive={child.props.value === value} />;\n            }\n            return null;\n          })}\n        </div>\n        {placement === 'bottom' ? headerNode : null}\n      </div>\n    );\n  },\n  { TabPanel },\n);\n\nTabs.displayName = 'Tabs';\n\nexport default Tabs;\n"],"names":["Tabs","forwardRefWithStatics","originalProps","ref","props","useDefaultProps","tabsDefaultProps","defaultValue","children","list","placement","tabValue","value","dragSort","className","style","onRemove","onChange","_useTabClass","useTabClass","tdTabsClassPrefix","tdTabsClassGenerator","tdClassGenerator","targetClassNameRegExpStr","_useDragSorter","useDragSorter","_objectSpread","sortOnDraggable","onDragOverCheck","x","targetClassNameRegExp","RegExp","getDragProps","memoChildren","React","useMemo","length","map","panelProps","createElement","TabPanel","key","itemList","Children","child","type","_React$useState","useState","Array","isArray","_React$useState2","_slicedToArray","setValue","useEffect","handleChange","useCallback","v","handleClickTab","headerNode","classNames","concat","TabNav","activeValue","tabClick","isActive","displayName"],"mappings":"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"}