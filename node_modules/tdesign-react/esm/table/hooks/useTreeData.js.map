{"version":3,"file":"useTreeData.js","sources":["../../../../components/table/hooks/useTreeData.tsx"],"sourcesContent":["import React, { MouseEvent, useEffect, useMemo, useState } from 'react';\nimport {\n  AddRectangleIcon as TdAddRectangleIcon,\n  MinusRectangleIcon as TdMinusRectangleIcon,\n} from 'tdesign-icons-react';\nimport { get } from 'lodash-es';\nimport classNames from 'classnames';\nimport TableTreeStore, { SwapParams } from '@tdesign/common-js/table/tree-store';\nimport { TdEnhancedTableProps, PrimaryTableCol, TableRowData, TableRowValue, TableRowState } from '../type';\nimport useClassName from './useClassName';\nimport { renderCell } from '../Cell';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport useGlobalIcon from '../../hooks/useGlobalIcon';\nimport { parseContentTNode } from '../../_util/parseTNode';\nimport useTreeDataExpand from './useTreeDataExpand';\n\nexport interface UseSwapParams<T> extends SwapParams<T> {\n  data: T[];\n}\n\nexport default function useTreeData(props: TdEnhancedTableProps) {\n  const { data, columns, tree, rowKey, treeExpandAndFoldIcon, expandedTreeNodes } = props;\n  const [store] = useState(() => new TableTreeStore() as InstanceType<typeof TableTreeStore>);\n  const [treeNodeCol, setTreeNodeCol] = useState<PrimaryTableCol>(() => getTreeNodeColumnCol());\n  const [dataSource, setDataSource] = useState<TdEnhancedTableProps['data']>(data || []);\n  const { tableTreeClasses } = useClassName();\n  const [locale, t] = useLocaleReceiver('table');\n  const { AddRectangleIcon, MinusRectangleIcon } = useGlobalIcon({\n    AddRectangleIcon: TdAddRectangleIcon,\n    MinusRectangleIcon: TdMinusRectangleIcon,\n  });\n\n  const rowDataKeys = useMemo(\n    () => ({\n      rowKey: rowKey || 'id',\n      childrenKey: tree?.childrenKey || 'children',\n    }),\n    [rowKey, tree?.childrenKey],\n  );\n\n  const [isDefaultExpandedTreeNodesExecute, setIsDefaultExpandedTreeNodesExecute] = useState(false);\n  const {\n    tExpandedTreeNode,\n    isDefaultExpandAllExecute,\n    expandAll,\n    foldAll,\n    updateExpandOnDataChange,\n    onExpandFoldIconClick,\n  } = useTreeDataExpand(props, { store, dataSource, rowDataKeys, setDataSource });\n\n  const checkedColumn = useMemo(() => columns.find((col) => col.colKey === 'row-select'), [columns]);\n\n  useEffect(() => {\n    if (!store || !checkedColumn) return;\n    // 第一次，不需要执行 updateDisabledState\n    const rowValue = get(dataSource[0], rowDataKeys.rowKey);\n    if (!store.treeDataMap.get(rowValue)) return;\n    store.updateDisabledState(dataSource, checkedColumn, rowDataKeys);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [checkedColumn]);\n\n  useEffect(\n    () => {\n      if (!data || !store) return;\n      // 如果没有树形解构，则不需要相关逻辑\n      if (tree) {\n        resetData(data);\n      } else {\n        setDataSource(data);\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [data, expandedTreeNodes],\n  );\n\n  useEffect(\n    () => {\n      const treeNodeColTmp = getTreeNodeColumnCol();\n      setTreeNodeCol(treeNodeColTmp);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [columns, props.tree?.treeNodeColumnIndex],\n  );\n\n  function resetData(data: TableRowData[]) {\n    const { columns, expandedTreeNodes, defaultExpandedTreeNodes } = props;\n    store.initialTreeStore(data, columns, rowDataKeys);\n    const defaultNeedExpand = Boolean(!isDefaultExpandedTreeNodesExecute && defaultExpandedTreeNodes?.length);\n    const needExpandAll = Boolean(tree?.defaultExpandAll && !isDefaultExpandAllExecute);\n    if ((tExpandedTreeNode?.length && !!(expandedTreeNodes || defaultNeedExpand)) || needExpandAll) {\n      updateExpandOnDataChange([...data]);\n      setIsDefaultExpandedTreeNodesExecute(true);\n    } else {\n      setDataSource([...data]);\n    }\n  }\n\n  function getTreeNodeStyle(level: number) {\n    if (level === undefined) return;\n    const indent = props.tree?.indent === undefined ? 24 : props.tree?.indent;\n    // 默认 1px 是为了临界省略\n    return indent ? { paddingLeft: `${level * indent || 1}px` } : {};\n  }\n\n  /**\n   * 对外暴露的组件实例方法，展开或收起某一行\n   * @param p 行数据\n   */\n  function toggleExpandData(p: { row: TableRowData; rowIndex: number }, trigger?: 'expand-fold-icon' | 'row-click') {\n    const currentData = { ...p };\n    // eslint-disable-next-line\n    if (p.row.__VIRTUAL_SCROLL_INDEX !== undefined) {\n      // eslint-disable-next-line\n      currentData.rowIndex = p.row.__VIRTUAL_SCROLL_INDEX;\n    }\n    const newData = store.toggleExpandData(currentData, dataSource, rowDataKeys);\n    setDataSource([...newData]);\n    const rowValue = get(p.row, rowDataKeys.rowKey);\n    props.onTreeExpandChange?.({\n      row: p.row,\n      rowIndex: p.rowIndex,\n      rowState: store?.treeDataMap?.get(rowValue),\n      trigger,\n    });\n  }\n\n  function getTreeNodeColumnCol() {\n    const { columns } = props;\n    let treeNodeColumnIndex = props.tree?.treeNodeColumnIndex || 0;\n    // type 存在，则表示表格内部渲染的特殊列，比如：展开行按钮、复选框、单选按钮等，不能作为树结点列。因此树结点展开列向后顺移\n    while (\n      columns[treeNodeColumnIndex]?.type ||\n      columns[treeNodeColumnIndex]?.colKey === '__EXPAND_ROW_ICON_COLUMN__'\n    ) {\n      treeNodeColumnIndex += 1;\n    }\n    return columns[treeNodeColumnIndex];\n  }\n\n  function formatTreeColumn(col: PrimaryTableCol): PrimaryTableCol {\n    if (!col || !treeNodeCol || !store) return {};\n    if (!props.tree || !Object.keys(props.tree).length || col.colKey !== treeNodeCol.colKey) return col;\n    const newCol = { ...treeNodeCol };\n    newCol.cell = (p) => {\n      const cellInfo = renderCell(\n        { ...p, col: { ...treeNodeCol } },\n        {\n          cellEmptyContent: props.cellEmptyContent,\n        },\n      );\n      const currentState = store.treeDataMap.get(get(p.row, rowDataKeys.rowKey));\n      const colStyle = getTreeNodeStyle(currentState?.level);\n      const classes = { [tableTreeClasses.inlineCol]: !!col.ellipsis };\n      const childrenNodes = get(p.row, rowDataKeys.childrenKey);\n      if ((childrenNodes && childrenNodes instanceof Array) || childrenNodes === true) {\n        const expanded = store.treeDataMap.get(get(p.row, rowDataKeys.rowKey))?.expanded;\n        const type = expanded ? 'fold' : 'expand';\n        const defaultIconNode =\n          t(locale.treeExpandAndFoldIcon, { type }) || (expanded ? <MinusRectangleIcon /> : <AddRectangleIcon />);\n        const iconNode = treeExpandAndFoldIcon\n          ? parseContentTNode(treeExpandAndFoldIcon, { type, ...p })\n          : defaultIconNode;\n        return (\n          <div className={classNames([tableTreeClasses.col, classes])} style={colStyle}>\n            {!!(childrenNodes.length || childrenNodes === true) && (\n              <span\n                className={tableTreeClasses.icon}\n                onClick={(e: MouseEvent<HTMLSpanElement>) => {\n                  onExpandFoldIconClick(p, 'expand-fold-icon');\n                  e.stopPropagation();\n                }}\n              >\n                {iconNode}\n              </span>\n            )}\n            {cellInfo}\n          </div>\n        );\n      }\n      return (\n        <div style={colStyle} className={classNames([classes, tableTreeClasses.leafNode])}>\n          <span className={tableTreeClasses.icon}></span>\n          {cellInfo}\n        </div>\n      );\n    };\n    // 树形节点会显示操作符号 [+] 和 [-]，但省略显示的浮层中不需要操作符\n    if (newCol.ellipsis === true) {\n      newCol.ellipsis = (p) => renderCell({ ...p, col: { ...treeNodeCol } });\n    }\n    return newCol;\n  }\n\n  /**\n   * 对外暴露的组件实例方法，设置行数据，自动刷新界面\n   * @param key 当前行唯一标识值\n   * @param newRowData 新行数据\n   */\n  function setData<T>(key: TableRowValue, newRowData: T) {\n    const rowIndex = store.updateData(key, newRowData, dataSource, rowDataKeys);\n    const newData = [...dataSource];\n    newData[rowIndex] = newRowData;\n    setDataSource([...newData]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，获取当前行全部数据\n   * @param key 行唯一标识\n   * @returns {TableRowState} 当前行数据\n   */\n  function getData(key: TableRowValue): TableRowState {\n    return store.getData(key);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，对外暴露的组件实例方法，移除指定节点\n   * @param key 行唯一标识\n   */\n  function remove(key: TableRowValue) {\n    // 引用传值，可自动更新 dataSource。（dataSource 本是内部变量，可以在任何地方进行任何改变）\n    const newData = store.remove(key, dataSource, rowDataKeys);\n    setDataSource([...newData]);\n  }\n\n  /**\n   * 移除子节点\n   * @param key 行唯一标识\n   */\n  function removeChildren(key: TableRowValue) {\n    const newData = store.removeChildren(key, dataSource, rowDataKeys);\n    setDataSource([...newData]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，为当前节点添加子节点，默认添加到最后一个节点\n   * @param key 当前节点唯一标识\n   * @param newData 待添加的新节点\n   */\n  function appendTo<T>(key: TableRowValue, newData: T | T[]) {\n    if (!key) {\n      setDataSource([...store.appendToRoot(newData, dataSource, rowDataKeys)]);\n      return;\n    }\n    // 引用传值，可自动更新 dataSource。（dataSource 本是内部变量，可以在任何地方进行任何改变）\n    setDataSource([...store.appendTo(key, newData, dataSource, rowDataKeys)]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，当前节点之后，插入节点\n   */\n  function insertAfter<T>(rowValue: TableRowValue, newData: T) {\n    setDataSource([...store.insertAfter(rowValue, newData, dataSource, rowDataKeys)]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，当前节点之后，插入节点\n   */\n  function insertBefore<T>(rowValue: TableRowValue, newData: T) {\n    setDataSource([...store.insertBefore(rowValue, newData, dataSource, rowDataKeys)]);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，交换行数据，React 在回掉函数函数中无法获取最新的 state 信息，因此需要参数 params.data\n   */\n  function swapData(params: UseSwapParams<TableRowData>) {\n    const r = store.swapData(params.data, params, rowDataKeys);\n    if (r.result) {\n      setDataSource([...r.dataSource]);\n    } else {\n      const params = {\n        code: r.code,\n        reason: r.reason,\n      };\n      props.onAbnormalDragSort?.(params);\n    }\n  }\n\n  /**\n   * 对外暴露的组件实例方法，获取全部数据的树形结构\n   * @param key 节点唯一标识\n   */\n  function getTreeNode() {\n    return store.getTreeNode(dataSource, rowDataKeys);\n  }\n\n  /**\n   * 对外暴露的组件实例方法，获取树形结构展开的节点\n   */\n  function getTreeExpandedRow(type: 'unique' | 'data' | 'all' = 'data') {\n    return store.getTreeExpandedRow(dataSource, rowDataKeys, type);\n  }\n\n  return {\n    store,\n    rowDataKeys,\n    dataSource,\n    swapData,\n    setData,\n    getData,\n    remove,\n    removeChildren,\n    appendTo,\n    insertAfter,\n    insertBefore,\n    formatTreeColumn,\n    toggleExpandData,\n    expandAll,\n    foldAll,\n    getTreeNode,\n    resetData,\n    getTreeExpandedRow,\n    onExpandFoldIconClick,\n  };\n}\n\nexport type UseTreeDataReturnType = ReturnType<typeof useTreeData>;\n"],"names":["useTreeData","props","_props$tree","data","columns","tree","rowKey","treeExpandAndFoldIcon","expandedTreeNodes","_useState","useState","TableTreeStore","_useState2","_slicedToArray","store","_useState3","getTreeNodeColumnCol","_useState4","treeNodeCol","setTreeNodeCol","_useState5","_useState6","dataSource","setDataSource","_useClassName","useClassName","tableTreeClasses","_useLocaleReceiver","useLocaleReceiver","_useLocaleReceiver2","locale","t","_useGlobalIcon","useGlobalIcon","AddRectangleIcon","TdAddRectangleIcon","MinusRectangleIcon","TdMinusRectangleIcon","rowDataKeys","useMemo","childrenKey","_useState7","_useState8","isDefaultExpandedTreeNodesExecute","setIsDefaultExpandedTreeNodesExecute","_useTreeDataExpand","useTreeDataExpand","tExpandedTreeNode","isDefaultExpandAllExecute","expandAll","foldAll","updateExpandOnDataChange","onExpandFoldIconClick","checkedColumn","find","col","colKey","useEffect","rowValue","get","treeDataMap","updateDisabledState","resetData","treeNodeColTmp","treeNodeColumnIndex","defaultExpandedTreeNodes","initialTreeStore","defaultNeedExpand","Boolean","length","needExpandAll","defaultExpandAll","_toConsumableArray","getTreeNodeStyle","level","_props$tree2","_props$tree3","indent","paddingLeft","concat","toggleExpandData","p","trigger","_props$onTreeExpandCh","_store$treeDataMap","currentData","_objectSpread","row","__VIRTUAL_SCROLL_INDEX","rowIndex","newData","onTreeExpandChange","call","rowState","_props$tree4","_columns2$treeNodeCol","type","_columns2$treeNodeCol2","formatTreeColumn","Object","keys","newCol","cell","cellInfo","renderCell","cellEmptyContent","currentState","colStyle","classes","_defineProperty","inlineCol","ellipsis","childrenNodes","Array","_store$treeDataMap$ge","expanded","defaultIconNode","React","createElement","iconNode","parseContentTNode","className","classNames","style","icon","onClick","e","stopPropagation","leafNode","setData","key","newRowData","updateData","getData","remove","removeChildren","appendTo","appendToRoot","insertAfter","insertBefore","swapData","params","r","result","_props$onAbnormalDrag","code","reason","onAbnormalDragSort","getTreeNode","getTreeExpandedRow"],"mappings":"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"}