{"version":3,"file":"usePosition.js","sources":["../../../../components/image-viewer/hooks/usePosition.ts"],"sourcesContent":["import { MouseEventHandler, useCallback, useEffect, useRef, useState } from 'react';\nimport { isFunction } from 'lodash-es';\n\nexport type PositionType = [number, number];\n\ninterface UsePositionArg {\n  initPosition?: PositionType;\n  move?: boolean;\n  computed?: (XY: PositionType, screenXY: PositionType, oldXY: PositionType) => PositionType;\n  onMouseUp?: (event?: MouseEvent) => void;\n  onMouseMove?: (event?: MouseEvent) => void;\n  onMouseDown?: (event?: MouseEventHandler<HTMLDivElement>) => void;\n}\n\nconst usePosition = (\n  { initPosition, move = true, onMouseUp: onEnd, onMouseMove: onUpdate, onMouseDown: onStart }: UsePositionArg,\n  $dom?: HTMLElement | Document,\n): [PositionType, MouseEventHandler<HTMLDivElement>] => {\n  const [position, setPosition] = useState<PositionType>(initPosition);\n  const cacheMoveDataRef = useRef(null);\n\n  const onMouseUp = useCallback(() => {\n    if (!cacheMoveDataRef.current) return;\n    cacheMoveDataRef.current = null;\n    if (!move) return;\n    isFunction(onEnd) && onEnd();\n  }, [move, onEnd]);\n\n  const onMouseMove = useCallback(\n    (event: MouseEvent | any) => {\n      if (!event.buttons) cacheMoveDataRef.current = null;\n      if (!cacheMoveDataRef.current || cacheMoveDataRef.current.updating || !move) return;\n      cacheMoveDataRef.current.updating = true;\n      const { screenX: oldX, screenY: oldY } = cacheMoveDataRef.current;\n      const { screenX, screenY } = event;\n\n      requestAnimationFrame(() => {\n        if (!cacheMoveDataRef.current) return;\n        setPosition(([X, Y]) => [X + screenX - oldX, Y + screenY - oldY]);\n        cacheMoveDataRef.current.screenX = screenX;\n        cacheMoveDataRef.current.screenY = screenY;\n        cacheMoveDataRef.current.updating = false;\n        isFunction(onUpdate) && onUpdate();\n      });\n    },\n    [move, onUpdate],\n  );\n\n  const onMouseDown: MouseEventHandler<HTMLDivElement> = useCallback(\n    (event) => {\n      const { screenX, screenY } = event;\n      cacheMoveDataRef.current = {\n        screenX,\n        screenY,\n      };\n      if (!move) return;\n      isFunction(onStart) && onStart();\n    },\n    [move, onStart],\n  );\n\n  useEffect(() => {\n    const dom = $dom || document;\n    dom.addEventListener('mousemove', onMouseMove);\n    document.addEventListener('mouseup', onMouseUp);\n    return () => {\n      dom.removeEventListener('mousemove', onMouseMove);\n      document.removeEventListener('mouseup', onMouseUp);\n    };\n  }, [$dom, move, onMouseMove, onMouseUp]);\n\n  return [position, onMouseDown];\n};\n\nexport default usePosition;\n"],"names":["usePosition","_ref","$dom","initPosition","_ref$move","move","onEnd","onMouseUp","onUpdate","onMouseMove","onStart","onMouseDown","_useState","useState","_useState2","_slicedToArray","position","setPosition","cacheMoveDataRef","useRef","useCallback","current","isFunction","event","buttons","updating","_cacheMoveDataRef$cur","oldX","screenX","oldY","screenY","requestAnimationFrame","_ref2","_ref3","X","Y","useEffect","dom","document","addEventListener","removeEventListener"],"mappings":"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"}