{"version":3,"file":"useVirtualScroll.js","sources":["../../../components/hooks/useVirtualScroll.ts"],"sourcesContent":["/**\n * 通用虚拟滚动，可支持 Select/List/Table/TreeSelect/Cascader 等组件\n */\nimport { useState, useMemo, useEffect, MutableRefObject, useRef } from 'react';\nimport { TScroll, ScrollToElementParams } from '../common';\nimport useResizeObserver from './useResizeObserver';\n\nexport type UseVirtualScrollParams = {\n  /** 列数据 */\n  data: { [key: string]: any }[];\n  scroll: TScroll & {\n    fixedRows?: Array<number>;\n  };\n};\n\nconst requestAnimationFrame =\n  (typeof window === 'undefined' ? false : window.requestAnimationFrame) || ((cb) => setTimeout(cb, 16.6));\n\nconst useVirtualScroll = (container: MutableRefObject<HTMLElement>, params: UseVirtualScrollParams) => {\n  const { data, scroll } = params;\n  /** 注意测试：数据长度为空；数据长度小于表格高度等情况。即期望只有数据量达到一定程度才允许开启虚拟滚动 */\n  const [visibleData, setVisibleData] = useState<any[]>([]);\n  // 滚动过程中表格顶部占位距离\n  const [translateY, setTranslateY] = useState(() => (data?.length || 0) * (scroll?.rowHeight || 50));\n  // 滚动高度，用于显示滚动条\n  const [scrollHeight, setScrollHeight] = useState(0);\n  const trScrollTopHeightList = useRef<number[]>([]);\n  // 已经通过节点渲染计算出来的各自行高\n  const [trHeightList, setTrHeightList] = useState<number[]>([]);\n  const containerWidth = useRef(0);\n  const containerHeight = useRef(0);\n  const [startAndEndIndex, setStartAndEndIndex] = useState<[number, number]>(() => [0, (scroll?.bufferSize || 10) * 3]);\n\n  // 设置初始值\n  const tScroll = useMemo(() => {\n    if (!scroll) return {};\n    return {\n      bufferSize: scroll.bufferSize || 10,\n      isFixedRowHeight: scroll.isFixedRowHeight ?? false,\n      rowHeight: scroll.rowHeight || 47,\n      threshold: scroll.threshold || 100,\n      type: scroll.type,\n      fixedRows: scroll.fixedRows ?? [0, 0],\n    };\n  }, [scroll]);\n\n  // 当前场景是否满足开启虚拟滚动的条件\n  const isVirtualScroll = useMemo(() => tScroll.type === 'virtual' && tScroll.threshold < data.length, [tScroll, data]);\n  const getTrScrollTopHeightList = (trHeightList: number[]) => {\n    const list: number[] = [];\n    // 大数据场景不建议使用 forEach 一类函数迭代\n    // 当前行滚动高度 = 上一行滚动高度 + 当前行高度\n    for (let i = 0, len = data.length; i < len; i++) {\n      list[i] = (list[i - 1] || 0) + (trHeightList[i] || tScroll.rowHeight);\n    }\n    return list;\n  };\n\n  // const tripleBufferSize = useMemo(() => tScroll.bufferSize * 3, [tScroll.bufferSize]);\n\n  const updateVisibleData = (trScrollTopHeightList: number[], scrollTop: number) => {\n    let currentIndex = -1;\n    // 获取当前滚动到哪一个元素（大数据场景不建议使用 forEach 一类函数迭代）\n    for (let i = 0, len = trScrollTopHeightList.length; i < len; i++) {\n      if (trScrollTopHeightList[i] >= scrollTop) {\n        currentIndex = i;\n        break;\n      }\n    }\n    let lastIndex = trScrollTopHeightList.length;\n    const containerCurrentHeight = containerHeight.current || container.current.getBoundingClientRect().height;\n    const scrollBottom = scrollTop + containerCurrentHeight;\n    // 获取当前视窗的最后一个元素（大数据场景不建议使用 forEach 一类函数迭代）\n    for (let i = currentIndex, len = trScrollTopHeightList.length; i < len; i++) {\n      if (trScrollTopHeightList[i] >= scrollBottom) {\n        lastIndex = i;\n        break;\n      }\n    }\n    if (currentIndex < 0) return;\n    const startIndex = Math.max(currentIndex - tScroll.bufferSize, 0);\n    const endIndex = Math.min(lastIndex + tScroll.bufferSize, trScrollTopHeightList.length);\n\n    // 计算固定行情况\n    const { fixedRows } = tScroll;\n    const [fixedStart, fixedEnd] = fixedRows;\n    let fixedStartData = fixedStart ? data.slice(0, fixedStart) : [];\n    if (fixedStart && startIndex < fixedStart) {\n      fixedStartData = fixedStartData.slice(0, startIndex);\n    }\n    let fixedEndData = fixedEnd ? data.slice(data.length - fixedEnd) : [];\n    const bottomStartIndex = endIndex - data.length + 1 + (fixedEnd ?? 0);\n    if (fixedEnd && bottomStartIndex > 0) {\n      fixedEndData = fixedEndData.slice(bottomStartIndex);\n    }\n\n    if (startAndEndIndex.join() !== [startIndex, endIndex].join() && startIndex >= 0) {\n      const tmpVisibleData = fixedStartData.concat(data.slice(startIndex, endIndex)).concat(fixedEndData);\n      setVisibleData(tmpVisibleData);\n      const lastScrollTop = trScrollTopHeightList[startIndex - 1];\n      const top = lastScrollTop > 0 ? lastScrollTop : 0;\n      const stickyHeight = trScrollTopHeightList[Math.min(startIndex, fixedStart) - 1] || 0;\n      setTranslateY(top - stickyHeight);\n      setStartAndEndIndex([startIndex, endIndex]);\n    }\n  };\n\n  // 仅非固定高度场景需要\n  const handleRowMounted = (rowData: any) => {\n    if (!isVirtualScroll || !rowData || tScroll.isFixedRowHeight || !container?.current) return;\n    const trHeight = rowData.ref.offsetHeight;\n    // eslint-disable-next-line\n    const rowIndex = rowData.data.__VIRTUAL_SCROLL_INDEX;\n    const newTrHeightList = trHeightList;\n    if (newTrHeightList[rowIndex] !== trHeight) {\n      newTrHeightList[rowIndex] = trHeight;\n      setTrHeightList(newTrHeightList);\n\n      const scrollTopHeightList = getTrScrollTopHeightList(newTrHeightList);\n      trScrollTopHeightList.current = scrollTopHeightList;\n\n      const lastIndex = scrollTopHeightList.length - 1;\n      setScrollHeight(scrollTopHeightList[lastIndex] - containerHeight.current);\n      updateVisibleData(scrollTopHeightList, container.current.scrollTop);\n    }\n  };\n\n  const handleScroll = () => {\n    if (!isVirtualScroll) return;\n    updateVisibleData(trScrollTopHeightList.current, container.current.scrollTop);\n  };\n\n  const refreshVirtualScroll = ([{ contentRect }]: [ResizeObserverEntry]) => {\n    // 如果宽度发生变化，重置滚动位置（高度发生变化时，会触发 container 变化，下方的 watch 会计算）\n    const maxScrollbarWidth = 16;\n    if (Math.abs(contentRect.width - containerWidth.current) > maxScrollbarWidth) {\n      // eslint-disable-next-line\n      container.current.scrollTop = 0;\n      // react container.current.scrollTop 有时候不会触发滚动事件，故而手动触发\n      handleScroll();\n    }\n    containerWidth.current = contentRect.width;\n    containerHeight.current = contentRect.height;\n  };\n\n  const addIndexToData = (data: any[]) => {\n    data.forEach((item, index) => {\n      Reflect.set(item, '__VIRTUAL_SCROLL_INDEX', index);\n    });\n  };\n\n  const updateScrollTop = ({ index, top = 0, behavior }: ScrollToElementParams) => {\n    const scrollTop = trScrollTopHeightList.current[index] - top;\n    container.current?.scrollTo({\n      top: scrollTop,\n      behavior: behavior || 'auto',\n    });\n  };\n\n  /**\n   * 滚动到指定元素（对外暴露的方法，谨慎修改）\n   */\n  const scrollToElement = (p: ScrollToElementParams) => {\n    updateScrollTop(p);\n    if (!tScroll.isFixedRowHeight) {\n      requestAnimationFrame(() => {\n        const duration = p.time ?? 60;\n        const timer = setTimeout(() => {\n          updateScrollTop(p);\n          clearTimeout(timer);\n        }, duration);\n      });\n    }\n  };\n\n  useResizeObserver(isVirtualScroll ? container.current : undefined, refreshVirtualScroll);\n\n  // 固定高度场景，可直接通过数据长度计算出最大滚动高度\n  useEffect(\n    () => {\n      if (!isVirtualScroll) {\n        trScrollTopHeightList.current = getTrScrollTopHeightList(trHeightList);\n        return;\n      }\n\n      // 给数据添加下标\n      addIndexToData(data);\n\n      const scrollTopHeightList = trScrollTopHeightList.current;\n      if (scrollTopHeightList?.length === data?.length) {\n        // 数据初始化后，根据计算结果更新\n        const lastIndex = scrollTopHeightList.length - 1;\n        setScrollHeight(scrollTopHeightList[lastIndex]);\n\n        updateVisibleData(scrollTopHeightList, container.current.scrollTop);\n      } else {\n        // 数据初始化\n        setScrollHeight(data.length * tScroll.rowHeight);\n\n        const tmpData = data.slice(0, (scroll?.bufferSize || 10) * 3);\n        setVisibleData(tmpData);\n        setTranslateY(0);\n      }\n\n      const timer = setTimeout(() => {\n        if (container.current) {\n          const tmpContainerHeight = container.current.getBoundingClientRect().height;\n          containerHeight.current = tmpContainerHeight;\n          const scrollTopHeightList = getTrScrollTopHeightList(trHeightList);\n          trScrollTopHeightList.current = scrollTopHeightList;\n          clearTimeout(timer);\n        }\n      }, 1);\n    },\n    // eslint-disable-next-line\n    [container, data, tScroll, isVirtualScroll, startAndEndIndex, trHeightList],\n  );\n\n  return {\n    visibleData,\n    translateY,\n    scrollHeight,\n    isVirtualScroll,\n    handleScroll,\n    handleRowMounted,\n    scrollToElement,\n  };\n};\n\nexport type VirtualScrollConfig = ReturnType<typeof useVirtualScroll>;\n\nexport default useVirtualScroll;\n"],"names":["requestAnimationFrame","window","cb","setTimeout","useVirtualScroll","container","params","data","scroll","_useState","useState","_useState2","_slicedToArray","visibleData","setVisibleData","_useState3","length","rowHeight","_useState4","translateY","setTranslateY","_useState5","_useState6","scrollHeight","setScrollHeight","trScrollTopHeightList","useRef","_useState7","_useState8","trHeightList","setTrHeightList","containerWidth","containerHeight","_useState9","bufferSize","_useState10","startAndEndIndex","setStartAndEndIndex","tScroll","useMemo","_scroll$isFixedRowHei","_scroll$fixedRows","isFixedRowHeight","threshold","type","fixedRows","isVirtualScroll","getTrScrollTopHeightList","list","i","len","updateVisibleData","scrollTop","currentIndex","lastIndex","containerCurrentHeight","current","getBoundingClientRect","height","scrollBottom","startIndex","Math","max","endIndex","min","_fixedRows","fixedStart","fixedEnd","fixedStartData","slice","fixedEndData","bottomStartIndex","join","tmpVisibleData","concat","lastScrollTop","top","stickyHeight","handleRowMounted","rowData","trHeight","ref","offsetHeight","rowIndex","__VIRTUAL_SCROLL_INDEX","newTrHeightList","scrollTopHeightList","handleScroll","refreshVirtualScroll","_ref2","_ref","contentRect","maxScrollbarWidth","abs","width","addIndexToData","forEach","item","index","Reflect","set","updateScrollTop","_container$current","_ref3$top","behavior","scrollTo","scrollToElement","p","_p$time","duration","time","timer","clearTimeout","useResizeObserver","useEffect","tmpData","tmpContainerHeight"],"mappings":"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"}