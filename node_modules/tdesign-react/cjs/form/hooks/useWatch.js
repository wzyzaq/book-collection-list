/**
 * tdesign v1.12.0
 * (c) 2025 tdesign
 * @license MIT
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var slicedToArray = require('../../_chunks/dep-b20af383.js');
var React = require('react');
var form_hooks_useForm = require('./useForm.js');
var _util_noop = require('../../_util/noop.js');
var get = require('../../_chunks/dep-e831607b.js');
var isUndefined = require('../../_chunks/dep-0f33907c.js');
require('../../_chunks/dep-7225af62.js');
require('../../_chunks/dep-b691f3a6.js');
require('../../_chunks/dep-e711efe7.js');
require('../../_chunks/dep-5481698f.js');
require('../../_chunks/dep-dab07be2.js');
require('../../_chunks/dep-e831f387.js');
require('../../_chunks/dep-29a8a75a.js');
require('../../_chunks/dep-cef99009.js');
require('../../_chunks/dep-ac9a26ed.js');
require('../../_chunks/dep-5dc79997.js');
require('../../_chunks/dep-350e0ec1.js');
require('../../_chunks/dep-ac56ab8f.js');
require('../../_chunks/dep-e3f45bee.js');
require('../../_chunks/dep-d4fd8ae6.js');
require('../../_chunks/dep-de258415.js');
require('../../_chunks/dep-7ffb0d81.js');
require('../../_chunks/dep-fff57180.js');

function useWatch(name, form) {
  var _useState = React.useState(),
    _useState2 = slicedToArray._slicedToArray(_useState, 2),
    value = _useState2[0],
    setValue = _useState2[1];
  var valueStr = React.useMemo(function () {
    return JSON.stringify(value);
  }, [value]);
  var valueStrRef = React.useRef(valueStr);
  var isValidForm = form && form._init;
  React.useEffect(function () {
    var _form$getInternalHook3, _form$getFieldsValue2;
    if (!isValidForm) return;
    var _form$getInternalHook = (_form$getInternalHook3 = form.getInternalHooks) === null || _form$getInternalHook3 === void 0 ? void 0 : _form$getInternalHook3.call(form, form_hooks_useForm.HOOK_MARK),
      _form$getInternalHook2 = _form$getInternalHook.registerWatch,
      registerWatch = _form$getInternalHook2 === void 0 ? _util_noop["default"] : _form$getInternalHook2;
    var cancelRegister = registerWatch(function () {
      var _form$getFieldsValue;
      var allFieldsValue2 = (_form$getFieldsValue = form.getFieldsValue) === null || _form$getFieldsValue === void 0 ? void 0 : _form$getFieldsValue.call(form, true);
      var newValue = get.get(allFieldsValue2, name);
      var nextValueStr = JSON.stringify(newValue);
      if (valueStrRef.current !== nextValueStr) {
        valueStrRef.current = nextValueStr;
        setValue(nextValueStr);
      }
    });
    var allFieldsValue = (_form$getFieldsValue2 = form.getFieldsValue) === null || _form$getFieldsValue2 === void 0 ? void 0 : _form$getFieldsValue2.call(form, true);
    var initialValue = get.get(allFieldsValue, name);
    setValue(JSON.stringify(initialValue));
    return cancelRegister;
  }, []);
  return isUndefined.isUndefined(value) ? value : JSON.parse(value);
}

exports["default"] = useWatch;
//# sourceMappingURL=useWatch.js.map
