{"version":3,"file":"useFormItemInitialData.js","sources":["../../../../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/unset.js","../../../../components/form/hooks/useFormItemInitialData.ts"],"sourcesContent":["import baseUnset from './_baseUnset.js';\n\n/**\n * Removes the property at `path` of `object`.\n *\n * **Note:** This method mutates `object`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Object\n * @param {Object} object The object to modify.\n * @param {Array|string} path The path of the property to unset.\n * @returns {boolean} Returns `true` if the property is deleted, else `false`.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 7 } }] };\n * _.unset(object, 'a[0].b.c');\n * // => true\n *\n * console.log(object);\n * // => { 'a': [{ 'b': {} }] };\n *\n * _.unset(object, ['a', '0', 'b', 'c']);\n * // => true\n *\n * console.log(object);\n * // => { 'a': [{ 'b': {} }] };\n */\nfunction unset(object, path) {\n  return object == null ? true : baseUnset(object, path);\n}\n\nexport default unset;\n","import React, { useEffect } from 'react';\nimport { get, unset, isEmpty } from 'lodash-es';\n\n// 兼容特殊数据结构和受控 key\nimport Tree from '../../tree/Tree';\nimport Upload from '../../upload/upload';\nimport CheckTag from '../../tag/CheckTag';\nimport Checkbox from '../../checkbox/Checkbox';\nimport TagInput from '../../tag-input/TagInput';\nimport RangeInput from '../../range-input/RangeInput';\nimport Transfer from '../../transfer/Transfer';\nimport CheckboxGroup from '../../checkbox/CheckboxGroup';\nimport DateRangePicker from '../../date-picker/DateRangePicker';\nimport TimeRangePicker from '../../time-picker/TimeRangePicker';\n\nimport { useFormContext, useFormListContext } from '../FormContext';\nimport { FormItemProps } from '../FormItem';\n\n// FormItem 子组件受控 key\nexport const ctrlKeyMap = new Map();\nctrlKeyMap.set(Checkbox, 'checked');\nctrlKeyMap.set(CheckTag, 'checked');\nctrlKeyMap.set(Upload, 'files');\n\n// FormItem 默认数据类型\nexport const initialDataMap = new Map();\n[Tree, Upload, Transfer, TagInput, RangeInput, CheckboxGroup, DateRangePicker, TimeRangePicker].forEach((component) => {\n  initialDataMap.set(component, []);\n});\n[Checkbox].forEach((component) => {\n  initialDataMap.set(component, false);\n});\n\nexport default function useFormItemInitialData(name: FormItemProps['name']) {\n  let hadReadFloatingFormData = false;\n\n  const { floatingFormDataRef, initialData: formContextInitialData } = useFormContext();\n\n  const { name: formListName, initialData: formListInitialData } = useFormListContext();\n\n  // 组件渲染后删除对应游离值\n  useEffect(() => {\n    if (hadReadFloatingFormData) {\n      const nameList = formListName ? [formListName, name].flat() : name;\n      unset(floatingFormDataRef.current, nameList);\n    }\n  }, [hadReadFloatingFormData, floatingFormDataRef, formListName, name]);\n\n  // 整理初始值 优先级：Form.initialData < FormList.initialData < FormItem.initialData < floatFormData\n  function getDefaultInitialData({\n    children,\n    initialData,\n  }: {\n    children: FormItemProps['children'];\n    initialData: FormItemProps['initialData'];\n  }) {\n    if (name && floatingFormDataRef?.current && !isEmpty(floatingFormDataRef.current)) {\n      const nameList = formListName ? [formListName, name].flat() : name;\n      const defaultInitialData = get(floatingFormDataRef.current, nameList);\n      if (typeof defaultInitialData !== 'undefined') {\n        hadReadFloatingFormData = true;\n        return defaultInitialData;\n      }\n    }\n\n    if (typeof initialData !== 'undefined') {\n      return initialData;\n    }\n\n    if (name && formListInitialData.length) {\n      const defaultInitialData = get(formListInitialData, name);\n      if (typeof defaultInitialData !== 'undefined') return defaultInitialData;\n    }\n\n    if (name && formContextInitialData) {\n      const defaultInitialData = get(formContextInitialData, name);\n      if (typeof defaultInitialData !== 'undefined') return defaultInitialData;\n    }\n\n    if (typeof children !== 'function') {\n      const childList = React.Children.toArray(children);\n      const lastChild = childList[childList.length - 1];\n      if (lastChild && React.isValidElement(lastChild)) {\n        // @ts-ignore\n        const isMultiple = lastChild?.props?.multiple;\n        return isMultiple ? [] : initialDataMap.get(lastChild.type);\n      }\n    }\n  }\n\n  return {\n    getDefaultInitialData,\n  };\n}\n"],"names":["unset","object","path","baseUnset","ctrlKeyMap","Map","set","Checkbox","CheckTag","Upload","initialDataMap","Tree","Transfer","TagInput","RangeInput","CheckboxGroup","DateRangePicker","TimeRangePicker","forEach","component","useFormItemInitialData","name","hadReadFloatingFormData","_useFormContext","useFormContext","floatingFormDataRef","formContextInitialData","initialData","_useFormListContext","useFormListContext","formListName","formListInitialData","useEffect","nameList","flat","current","getDefaultInitialData","_ref","children","isEmpty","defaultInitialData","get","length","childList","React","Children","toArray","lastChild","isValidElement","_lastChild$props","isMultiple","props","multiple","type"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,KAAKA,CAACC,MAAM,EAAEC,IAAI,EAAE;EAC3B,OAAOD,MAAM,IAAI,IAAI,GAAG,IAAI,GAAGE,cAAS,CAACF,MAAM,EAAEC,IAAI,CAAC,CAAA;AACxD;;ICZaE,UAAA,sBAAiBC,GAAI,GAAA;AAClCD,UAAW,CAAAE,GAAA,CAAIC,iCAAU,SAAS,CAAA,CAAA;AAClCH,UAAW,CAAAE,GAAA,CAAIE,yBAAU,SAAS,CAAA,CAAA;AAClCJ,UAAW,CAAAE,GAAA,CAAIG,0BAAQ,OAAO,CAAA,CAAA;IAGjBC,cAAA,sBAAqBL,GAAI,GAAA;AACtC,CAACM,oBAAA,EAAMF,wBAAQ,EAAAG,4BAAA,EAAUC,4BAAU,EAAAC,gCAAA,EAAYC,oCAAe,EAAAC,qCAAA,EAAiBC,qCAAe,CAAA,CAAEC,OAAQ,CAAA,UAACC,SAAc,EAAA;AACtGT,EAAAA,cAAA,CAAAJ,GAAA,CAAIa,SAAW,EAAA,EAAE,CAAA,CAAA;AAClC,CAAC,CAAA,CAAA;AACD,CAACZ,+BAAQ,CAAA,CAAEW,OAAQ,CAAA,UAACC,SAAc,EAAA;AACjBT,EAAAA,cAAA,CAAAJ,GAAA,CAAIa,WAAW,KAAK,CAAA,CAAA;AACrC,CAAC,CAAA,CAAA;AAED,SAAwBC,uBAAuBC,IAA6B,EAAA;EAC1E,IAAIC,uBAA0B,GAAA,KAAA,CAAA;AAE9B,EAAA,IAAAC,eAAA,GAAqEC,+BAAe,EAAA;IAA5EC,mBAAA,GAAAF,eAAA,CAAAE,mBAAA;IAAkCC,sBAAA,GAAAH,eAAA,CAAbI,WAAa,CAAA;AAE1C,EAAA,IAAAC,mBAAA,GAAiEC,mCAAmB,EAAA;IAAtEC,YAAA,GAAAF,mBAAA,CAANP,IAAM;IAA2BU,mBAAA,GAAAH,mBAAA,CAAbD,WAAa,CAAA;AAGzCK,EAAAA,eAAA,CAAU,YAAM;AACd,IAAA,IAAIV,uBAAyB,EAAA;AAC3B,MAAA,IAAMW,WAAWH,YAAe,GAAA,CAACA,cAAcT,IAAI,CAAA,CAAEa,MAAS,GAAAb,IAAA,CAAA;AACxDrB,MAAAA,KAAA,CAAAyB,mBAAA,CAAoBU,SAASF,QAAQ,CAAA,CAAA;AAC7C,KAAA;KACC,CAACX,uBAAA,EAAyBG,mBAAqB,EAAAK,YAAA,EAAcT,IAAI,CAAC,CAAA,CAAA;EAGrE,SAASe,qBAAsBA,CAAAC,IAAA,EAM5B;AAAA,IAAA,IALDC,QAAA,GAAAD,IAAA,CAAAC,QAAA;MACAX,WAAA,GAAAU,IAAA,CAAAV,WAAA,CAAA;AAKA,IAAA,IAAIN,QAAQI,mBAAqB,KAArBA,IAAAA,IAAAA,mBAAqB,eAArBA,mBAAqB,CAAAU,OAAA,IAAW,CAACI,eAAQ,CAAAd,mBAAA,CAAoBU,OAAO,CAAG,EAAA;AACjF,MAAA,IAAMF,WAAWH,YAAe,GAAA,CAACA,cAAcT,IAAI,CAAA,CAAEa,MAAS,GAAAb,IAAA,CAAA;MAC9D,IAAMmB,kBAAqB,GAAAC,OAAA,CAAIhB,mBAAoB,CAAAU,OAAA,EAASF,QAAQ,CAAA,CAAA;AAChE,MAAA,IAAA,OAAOO,uBAAuB,WAAa,EAAA;AACnBlB,QAAAA,uBAAA,GAAA,IAAA,CAAA;AACnB,QAAA,OAAAkB,kBAAA,CAAA;AACT,OAAA;AACF,KAAA;AAEI,IAAA,IAAA,OAAOb,gBAAgB,WAAa,EAAA;AAC/B,MAAA,OAAAA,WAAA,CAAA;AACT,KAAA;AAEI,IAAA,IAAAN,IAAA,IAAQU,oBAAoBW,MAAQ,EAAA;AAChC,MAAA,IAAAF,mBAAA,GAAqBC,OAAI,CAAAV,mBAAA,EAAqBV,IAAI,CAAA,CAAA;AACxD,MAAA,IAAI,OAAOmB,mBAAuB,KAAA,WAAA,EAAoB,OAAAA,mBAAA,CAAA;AACxD,KAAA;IAEA,IAAInB,QAAQK,sBAAwB,EAAA;AAC5B,MAAA,IAAAc,oBAAA,GAAqBC,OAAI,CAAAf,sBAAA,EAAwBL,IAAI,CAAA,CAAA;AAC3D,MAAA,IAAI,OAAOmB,oBAAuB,KAAA,WAAA,EAAoB,OAAAA,oBAAA,CAAA;AACxD,KAAA;AAEI,IAAA,IAAA,OAAOF,aAAa,UAAY,EAAA;MAClC,IAAMK,SAAY,GAAAC,yBAAA,CAAMC,QAAS,CAAAC,OAAA,CAAQR,QAAQ,CAAA,CAAA;MAC3C,IAAAS,SAAA,GAAYJ,SAAU,CAAAA,SAAA,CAAUD,MAAS,GAAA,CAAA,CAAA,CAAA;MAC/C,IAAIK,SAAa,iBAAAH,yBAAA,CAAMI,cAAe,CAAAD,SAAS,CAAG,EAAA;AAAA,QAAA,IAAAE,gBAAA,CAAA;AAE1C,QAAA,IAAAC,UAAA,GAAaH,cAAAA,IAAAA,IAAAA,4CAAAA,UAAWI,KAAO,MAAAF,IAAAA,IAAAA,gBAAA,KAAlBA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,gBAAA,CAAkBG,QAAA,CAAA;QACrC,OAAOF,aAAa,EAAC,GAAIxC,cAAe,CAAA+B,GAAA,CAAIM,UAAUM,IAAI,CAAA,CAAA;AAC5D,OAAA;AACF,KAAA;AACF,GAAA;EAEO,OAAA;AACLjB,IAAAA,qBAAA,EAAAA,qBAAAA;GACF,CAAA;AACF;;;;;;"}