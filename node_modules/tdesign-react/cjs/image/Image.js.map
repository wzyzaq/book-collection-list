{"version":3,"file":"Image.js","sources":["../../../components/image/Image.tsx"],"sourcesContent":["import React, { Fragment, useEffect, useRef, useState, SyntheticEvent, MouseEvent } from 'react';\nimport classNames from 'classnames';\nimport { isFunction } from 'lodash-es';\nimport { ImageErrorIcon as TdImageErrorIcon, ImageIcon as TdImageIcon } from 'tdesign-icons-react';\nimport observe from '@tdesign/common-js/utils/observe';\nimport useConfig from '../hooks/useConfig';\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\nimport { TdImageProps } from './type';\nimport { imageDefaultProps } from './defaultProps';\nimport Space from '../space';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport { StyledProps } from '../common';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport useImagePreviewUrl from '../hooks/useImagePreviewUrl';\n\nexport function isImageValid(src: string) {\n  return new Promise((resolve) => {\n    const img = document.createElement('img');\n    img.onerror = () => resolve(false);\n    img.onload = () => resolve(true);\n    img.src = src;\n  });\n}\n\nexport type ImageProps = TdImageProps &\n  StyledProps & {\n    onClick?: (e: MouseEvent<HTMLDivElement>) => void;\n    onMouseDown?: (e: MouseEvent<HTMLDivElement>) => void;\n    draggable?: boolean;\n  };\n\nconst InternalImage: React.ForwardRefRenderFunction<HTMLDivElement, ImageProps> = (originalProps, ref) => {\n  const props = useDefaultProps<ImageProps>(originalProps, imageDefaultProps);\n  const {\n    className,\n    src,\n    style,\n    fit,\n    position,\n    shape,\n    placeholder,\n    loading,\n    error,\n    overlayTrigger,\n    lazy,\n    gallery,\n    overlayContent,\n    srcset,\n    fallback,\n    onLoad,\n    onError,\n    ...waitPassRest\n  } = props;\n  const {\n    // penetrate pass to image tag element props\n    alt,\n    referrerpolicy,\n    ...rest\n  } = waitPassRest;\n\n  const { classPrefix } = useConfig();\n  const imageRef = useRef<HTMLDivElement>(null);\n  const [local, t] = useLocaleReceiver('image');\n  const { ImageErrorIcon, ImageIcon } = useGlobalIcon({\n    ImageErrorIcon: TdImageErrorIcon,\n    ImageIcon: TdImageIcon,\n  });\n\n  React.useImperativeHandle(ref, () => imageRef.current);\n\n  const [imageSrc, setImageSrc] = useState(src);\n\n  useEffect(() => {\n    const tmpUrl = isFunction(local.replaceImageSrc) ? local.replaceImageSrc(props) : src;\n    if (tmpUrl === imageSrc && imageSrc) return;\n    setImageSrc(tmpUrl);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [src, local, props]);\n\n  const { previewUrl } = useImagePreviewUrl(imageSrc);\n\n  const [shouldLoad, setShouldLoad] = useState(!lazy);\n  const handleLoadImage = () => {\n    setShouldLoad(true);\n  };\n\n  const [isLoaded, setIsLoaded] = useState(false);\n  const handleLoad = (e: SyntheticEvent<HTMLImageElement>) => {\n    setIsLoaded(true);\n    onLoad?.({ e });\n  };\n\n  useEffect(() => {\n    if (!lazy || !imageRef?.current) {\n      return;\n    }\n\n    // https://stackoverflow.com/questions/67069827/cleanup-ref-issues-in-react\n    let observerRefValue = null;\n\n    const io = observe(imageRef.current, null, handleLoadImage, 0);\n    observerRefValue = imageRef.current;\n\n    return () => {\n      observerRefValue && io && io.unobserve(observerRefValue);\n    };\n  }, [lazy, imageRef]);\n\n  const [hasError, setHasError] = useState(false);\n\n  // 判断是否执行过onError事件，要不在CSR模式下会执行两次onError\n  const isFirstError = useRef(false);\n  const handleError = (e: SyntheticEvent<HTMLImageElement>) => {\n    isFirstError.current = true;\n    setHasError(true);\n    if (fallback) {\n      setImageSrc(fallback);\n      setHasError(false);\n    }\n    onError?.({ e });\n  };\n\n  const imgRef = useRef(null);\n  useEffect(() => {\n    if (hasError && previewUrl) {\n      setHasError(false);\n    }\n    // 在SSR在判断执行onError\n    previewUrl &&\n      isImageValid(previewUrl as string).then((isValid) => {\n        //  SSR模式下会执行，CSR模式下不会执行\n        //  这里添加setTimeout是因为CSR image渲染时，onError有时快有时慢，会导致执行顺序不同导致的bug\n        setTimeout(() => {\n          if (!isValid && !isFirstError.current) {\n            //  SSR模式下获取不到 image 的合成事件，暂时传递 image 实例\n            handleError(imgRef.current);\n          }\n        }, 0);\n      });\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [previewUrl]);\n\n  useEffect(() => {\n    // SSR下执行\n    if (imgRef.current) {\n      const { complete, naturalWidth, naturalHeight } = imgRef.current;\n      if (complete && naturalWidth !== 0 && naturalHeight !== 0) {\n        //  SSR模式下获取不到 image 的合成事件，暂时传递 image 实例\n        handleLoad(imgRef.current);\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const hasMouseEvent = overlayTrigger === 'hover';\n  const [shouldShowOverlay, setShouldShowOverlay] = useState(!hasMouseEvent);\n  const handleToggleOverlay = (overlay: boolean) => {\n    setShouldShowOverlay(overlay);\n  };\n  const renderOverlay = () => {\n    if (!overlayContent) {\n      return null;\n    }\n    return (\n      <div\n        className={classNames(\n          `${classPrefix}-image__overlay-content`,\n          !shouldShowOverlay && `${classPrefix}-image__overlay-content--hidden`,\n        )}\n      >\n        {overlayContent}\n      </div>\n    );\n  };\n\n  const renderPlaceholder = () => {\n    if (!placeholder) {\n      return null;\n    }\n    return <div className={`${classPrefix}-image__placeholder`}>{placeholder}</div>;\n  };\n\n  const renderGalleryShadow = () => {\n    if (!gallery) {\n      return null;\n    }\n    return <div className={`${classPrefix}-image__gallery-shadow`} />;\n  };\n\n  const renderImage = () => {\n    const url = typeof imageSrc === 'string' ? imageSrc : previewUrl;\n    return (\n      <img\n        ref={imgRef}\n        src={url}\n        onError={handleError}\n        onLoad={handleLoad}\n        className={classNames(\n          `${classPrefix}-image`,\n          `${classPrefix}-image--fit-${fit}`,\n          `${classPrefix}-image--position-${position}`,\n        )}\n        alt={alt}\n        referrerPolicy={referrerpolicy}\n      />\n    );\n  };\n\n  const renderImageSrcset = () => (\n    <picture>\n      {Object.entries(props.srcset).map(([type, url]) => (\n        <source key={url} type={type} srcSet={url} />\n      ))}\n      {props.src && renderImage()}\n    </picture>\n  );\n\n  return (\n    <div\n      ref={imageRef}\n      className={classNames(\n        `${classPrefix}-image__wrapper`,\n        `${classPrefix}-image__wrapper--shape-${shape}`,\n        gallery && `${classPrefix}-image__wrapper--gallery`,\n        hasMouseEvent && `${classPrefix}-image__wrapper--need-hover`,\n        className,\n      )}\n      style={style}\n      {...(hasMouseEvent\n        ? {\n            onMouseEnter: () => handleToggleOverlay(true),\n            onMouseLeave: () => handleToggleOverlay(false),\n          }\n        : null)}\n      {...rest}\n    >\n      {renderPlaceholder()}\n\n      {renderGalleryShadow()}\n\n      {!(hasError || !shouldLoad) && (\n        <Fragment>\n          {srcset && Object.keys(srcset).length ? renderImageSrcset() : renderImage()}\n          {!(hasError || !shouldLoad) && !isLoaded && (\n            <div className={`${classPrefix}-image__loading`}>\n              {loading || (\n                <Space direction=\"vertical\" size={8} align=\"center\">\n                  <ImageIcon size={24} />\n                  {/* support loading = '' to hide loading text */}\n                  {typeof loading === 'string' ? loading : t(local.loadingText)}\n                </Space>\n              )}\n            </div>\n          )}\n        </Fragment>\n      )}\n\n      {hasError && (\n        <div className={`${classPrefix}-image__error`}>\n          {error || (\n            <Space direction=\"vertical\" size={8} align=\"center\">\n              <ImageErrorIcon size={24} />\n              {typeof error === 'string' ? error : t(local.errorText)}\n            </Space>\n          )}\n        </div>\n      )}\n      {renderOverlay()}\n    </div>\n  );\n};\n\nconst Image = React.forwardRef<HTMLDivElement, ImageProps>(InternalImage);\n\nImage.displayName = 'Image';\n\nexport default Image;\n"],"names":["isImageValid","src","Promise","resolve","img","document","createElement","onerror","onload","InternalImage","originalProps","ref","props","useDefaultProps","imageDefaultProps","className","style","fit","position","shape","placeholder","loading","error","overlayTrigger","lazy","gallery","overlayContent","srcset","fallback","onLoad","onError","waitPassRest","_objectWithoutProperties","_excluded","alt","referrerpolicy","rest","_excluded2","_useConfig","useConfig","classPrefix","imageRef","useRef","_useLocaleReceiver","useLocaleReceiver","_useLocaleReceiver2","_slicedToArray","local","t","_useGlobalIcon","useGlobalIcon","ImageErrorIcon","TdImageErrorIcon","ImageIcon","TdImageIcon","React","useImperativeHandle","current","_useState","useState","_useState2","imageSrc","setImageSrc","useEffect","tmpUrl","isFunction","replaceImageSrc","_useImagePreviewUrl","useImagePreviewUrl","previewUrl","_useState3","_useState4","shouldLoad","setShouldLoad","handleLoadImage","_useState5","_useState6","isLoaded","setIsLoaded","handleLoad","e","observerRefValue","io","observe","unobserve","_useState7","_useState8","hasError","setHasError","isFirstError","handleError","imgRef","then","isValid","setTimeout","_imgRef$current","complete","naturalWidth","naturalHeight","hasMouseEvent","_useState9","_useState10","shouldShowOverlay","setShouldShowOverlay","handleToggleOverlay","overlay","renderOverlay","classNames","concat","renderPlaceholder","renderGalleryShadow","renderImage","url","referrerPolicy","renderImageSrcset","Object","entries","map","_ref","_ref2","type","key","srcSet","_objectSpread","onMouseEnter","onMouseLeave","Fragment","keys","length","Space","direction","size","align","loadingText","errorText","Image","forwardRef","displayName"],"mappings":"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"}