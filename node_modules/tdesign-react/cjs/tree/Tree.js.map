{"version":3,"file":"Tree.js","sources":["../../../components/tree/Tree.tsx"],"sourcesContent":["import React, {\n  forwardRef,\n  useState,\n  useImperativeHandle,\n  useMemo,\n  RefObject,\n  MouseEvent,\n  useRef,\n  useCallback,\n} from 'react';\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\nimport classNames from 'classnames';\nimport { get } from 'lodash-es';\n\nimport TreeNode from '@tdesign/common-js/tree-v1/tree-node';\nimport log from '@tdesign/common-js/log/index';\nimport type {\n  TreeNodeState,\n  TreeNodeValue,\n  TypeTreeNodeData,\n  TypeTreeNodeModel,\n} from '@tdesign/common-js/tree-v1/types';\nimport { TreeOptionData, StyledProps, ComponentScrollToElementParams } from '../common';\nimport { TreeItemProps } from './interface';\nimport TreeItem from './TreeItem';\n\nimport useControllable from './hooks/useControllable';\nimport { useStore } from './hooks/useStore';\nimport { useTreeConfig } from './hooks/useTreeConfig';\nimport { TreeDraggableContext } from './hooks/TreeDraggableContext';\nimport parseTNode from '../_util/parseTNode';\nimport { usePersistFn } from '../hooks/usePersistFn';\nimport useTreeVirtualScroll from './hooks/useTreeVirtualScroll';\n\nimport type { TreeInstanceFunctions, TdTreeProps } from './type';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport type TreeProps = TdTreeProps & StyledProps;\n\nconst Tree = forwardRef<TreeInstanceFunctions<TreeOptionData>, TreeProps>((originalProps, ref) => {\n  const { treeClassNames, transitionNames, transitionClassNames, transitionDuration, locale } = useTreeConfig();\n  const props = useDefaultProps<TreeProps>(originalProps, {\n    data: [],\n    expandLevel: 0,\n    icon: true,\n    line: false,\n    transition: true,\n    lazy: true,\n    valueMode: 'onlyLeaf',\n  });\n\n  // 可见节点集合\n  const [visibleNodes, setVisibleNodes] = useState([]);\n  const {\n    empty,\n    activable,\n    disabled,\n    checkable,\n    checkProps,\n    disableCheck,\n    hover,\n    icon,\n    line,\n    label,\n    operations,\n    transition, // 动画默认开启\n    expandOnClickNode,\n    onClick,\n    scroll,\n    className,\n    style,\n    allowDrop,\n    onScroll,\n  } = props;\n\n  const { value, onChange, expanded, onExpand, onActive, actived, setTreeIndeterminate, indeterminate } =\n    useControllable(props);\n\n  // 国际化文本初始化\n  const emptyText = locale('empty');\n\n  const store = useStore(\n    {\n      ...props,\n      value,\n      onChange,\n      expanded,\n      onExpand,\n      onActive,\n      actived,\n      indeterminate,\n      setTreeIndeterminate,\n    },\n    initial,\n  );\n\n  function initial() {\n    const nodes = store?.getNodes();\n    const newVisibleNodes = nodes?.filter((node) => node.visible);\n    setVisibleNodes(newVisibleNodes);\n  }\n  // 因为是被 useImperativeHandle 依赖的方法，使用 usePersistFn 变成持久化的。或者也可以使用 useCallback\n  const setExpanded = usePersistFn(\n    (\n      node: TreeNode,\n      isExpanded: boolean,\n      ctx: { e?: MouseEvent<HTMLDivElement>; trigger: 'node-click' | 'icon-click' | 'setItem' },\n    ) => {\n      const { e, trigger } = ctx;\n      const expanded = node.setExpanded(isExpanded);\n      const treeNodeModel = node?.getModel();\n      (e || trigger) && onExpand?.(expanded, { node: treeNodeModel, e, trigger });\n      return expanded;\n    },\n  );\n\n  // 因为是被 useImperativeHandle 依赖的方法，使用 usePersistFn 变成持久化的。或者也可以使用 useCallback\n  const setIndeterminate = usePersistFn(\n    (\n      node: TreeNode,\n      isIndeterminate: boolean,\n      ctx: { e?: MouseEvent<HTMLDivElement>; trigger: 'node-click' | 'icon-click' | 'setItem' },\n    ) => {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const { e, trigger } = ctx;\n      const indeterminate = node.setIndeterminate(isIndeterminate);\n      return indeterminate;\n    },\n  );\n\n  const treeRef = useRef(null);\n\n  const {\n    visibleData,\n    isVirtual,\n    treeNodeStyle: virtualTreeNodeStyle,\n    cursorStyle,\n    handleRowMounted,\n    scrollToElement,\n  } = useTreeVirtualScroll({\n    treeRef,\n    scroll,\n    data: visibleNodes,\n    onScroll,\n  });\n\n  const setActived = usePersistFn(\n    (\n      node: TreeNode,\n      isActived: boolean,\n      ctx: { e?: MouseEvent<HTMLDivElement>; trigger: 'node-click' | 'setItem' },\n    ) => {\n      const actived = node.setActived(isActived);\n      const treeNodeModel = node?.getModel();\n      onActive?.(actived, { node: treeNodeModel, ...ctx });\n      return actived;\n    },\n  );\n\n  const setChecked = usePersistFn(\n    (node: TreeNode, isChecked: boolean, ctx: { e?: any; trigger: 'node-click' | 'setItem' }) => {\n      const checked = node.setChecked(isChecked);\n      const treeNodeModel = node?.getModel();\n      onChange?.(checked, { node: treeNodeModel, ...ctx });\n      return checked;\n    },\n  );\n\n  const handleItemClick: TreeItemProps['onClick'] = (node, options) => {\n    if (!node) {\n      return;\n    }\n    const isDisabled = disabled || node.disabled;\n    const { expand, active, e, trigger } = options;\n    if (expand) setExpanded(node, !node.isExpanded(), { e, trigger });\n\n    if (!isDisabled) {\n      const treeNodeModel = node?.getModel();\n      if (active) {\n        setActived(node, !node.isActived(), { e, trigger: 'node-click' });\n        onClick?.({ node: treeNodeModel, e });\n      } else {\n        onClick?.({ node: treeNodeModel, e });\n      }\n    }\n  };\n\n  const handleChange: TreeItemProps['onChange'] = (node, ctx) => {\n    if (!node || disabled || node.disabled) {\n      return;\n    }\n    setChecked(node, !node.isChecked(), { ...ctx, trigger: 'node-click' });\n  };\n  const handleScrollToElement = useCallback(\n    (params: ComponentScrollToElementParams) => {\n      let { index } = params;\n\n      if (!index && index !== 0) {\n        if (!params.key) {\n          log.error('Tree', 'scrollToElement: one of `index` or `key` must exist.');\n          return;\n        }\n        const data = visibleNodes;\n        index = data?.findIndex((item) => [get(item.data, 'key'), get(item.data, 'value')].includes(params.key));\n        if (index < 0) {\n          log.error('Tree', `${params.key} does not exist in data, check \\`key\\` or \\`data\\` please.`);\n        }\n      }\n      scrollToElement({ ...params, index });\n    },\n    [scrollToElement, visibleNodes],\n  );\n  /** 对外暴露的公共方法 * */\n  useImperativeHandle<unknown, TreeInstanceFunctions>(\n    ref,\n    () => ({\n      store,\n      scrollTo: (p: ComponentScrollToElementParams) => handleScrollToElement(p),\n      appendTo(value, newData) {\n        let list = [];\n        if (Array.isArray(newData)) {\n          list = newData;\n        } else {\n          list = [newData];\n        }\n        list.forEach((item) => {\n          store.appendNodes(value, item);\n        });\n      },\n      getIndex(value: TreeNodeValue): number {\n        return store.getNodeIndex(value);\n      },\n      getItem(value: TreeNodeValue): TypeTreeNodeModel {\n        const node: TreeNode = store.getNode(value);\n        return node?.getModel();\n      },\n      getItems(value?: TreeNodeValue): TypeTreeNodeModel[] {\n        const nodes = store.getNodes(value);\n        return nodes.map((node: TreeNode) => node.getModel());\n      },\n      getParent(value: TreeNodeValue): TypeTreeNodeModel {\n        const node = store.getParent(value);\n        return node?.getModel();\n      },\n      getParents(value: TreeNodeValue): TypeTreeNodeModel[] {\n        const nodes = store.getParents(value);\n        return nodes.map((node: TreeNode) => node.getModel());\n      },\n      getPath(value: TreeNodeValue): TypeTreeNodeModel[] {\n        const node = store.getNode(value);\n        let pathNodes = [];\n        if (node) {\n          pathNodes = node.getPath().map((node: TreeNode) => node.getModel());\n        }\n        return pathNodes;\n      },\n      insertAfter(value: TreeNodeValue, newData: TreeOptionData): void {\n        return store.insertAfter(value, newData as TypeTreeNodeData);\n      },\n      insertBefore(value: TreeNodeValue, newData: TreeOptionData): void {\n        return store.insertBefore(value, newData as TypeTreeNodeData);\n      },\n      remove(value: TreeNodeValue): void {\n        return store.remove(value);\n      },\n      setItem(value: TreeNodeValue, options: TreeNodeState): void {\n        const node: TreeNode = this.store.getNode(value);\n        const spec = options;\n        if (node && spec) {\n          if ('expanded' in options) {\n            setExpanded(node, spec.expanded, { trigger: 'setItem' });\n            delete spec.expanded;\n          }\n          if ('actived' in options) {\n            setActived(node, spec.actived, { trigger: 'setItem' });\n            delete spec.actived;\n          }\n          if ('checked' in options) {\n            setChecked(node, spec.checked, { trigger: 'setItem' });\n            delete spec.checked;\n          }\n          if ('indeterminate' in options) {\n            // @ts-ignore\n            setTreeIndeterminate((prevIndeterminate: TreeNodeValue[]) => [...prevIndeterminate, value]);\n            setIndeterminate(node, spec.indeterminate, { trigger: 'setItem' });\n            delete spec.indeterminate;\n          }\n          node.set(spec);\n        }\n      },\n    }),\n    [store, setExpanded, setActived, setTreeIndeterminate, setChecked, setIndeterminate, handleScrollToElement],\n  );\n\n  /* ======== render ======= */\n  // https://github.com/reactjs/react-transition-group/issues/668\n  // CSSTransition 不指定 nodeRef 的时候会使用 findDOMNode 获取 dom\n  // 因为 CSSTransition 是个数组，与 visibleNodes 对应，所以这里根据 visibleNodes 的长度创建 ref 用来保存 dom\n  // visibleNodes 改变的时候，释放上一个 nodeList，防止内存泄漏\n  const nodeList = useMemo<RefObject<HTMLDivElement>[]>(\n    () => visibleNodes.map(() => React.createRef()),\n    [visibleNodes],\n  );\n\n  const renderEmpty = () => parseTNode(empty, null, emptyText);\n\n  const renderItems = (renderNode: TreeNode[]) => {\n    if (renderNode.length <= 0) {\n      return renderEmpty();\n    }\n    if (isVirtual)\n      return (\n        <div className={treeClassNames.treeList} style={virtualTreeNodeStyle}>\n          {renderNode.map((node, index) => (\n            <TreeItem\n              ref={nodeList[index]}\n              key={node.value}\n              node={node}\n              keys={props.keys}\n              empty={empty}\n              icon={icon}\n              label={label}\n              line={line}\n              allowDrop={allowDrop}\n              transition={transition}\n              expandOnClickNode={expandOnClickNode}\n              activable={activable}\n              operations={operations}\n              checkProps={checkProps}\n              disableCheck={disableCheck}\n              onClick={handleItemClick}\n              onChange={handleChange}\n              onTreeItemMounted={handleRowMounted}\n              isVirtual={isVirtual}\n            />\n          ))}\n        </div>\n      );\n\n    return (\n      <TransitionGroup name={transitionNames.treeNode} className={treeClassNames.treeList}>\n        {renderNode.map((node, index) => (\n          // https://github.com/reactjs/react-transition-group/issues/668\n          <CSSTransition\n            nodeRef={nodeList[index]}\n            key={node.value}\n            timeout={transitionDuration}\n            classNames={transitionClassNames}\n          >\n            <TreeItem\n              ref={nodeList[index]}\n              node={node}\n              keys={props.keys}\n              empty={empty}\n              icon={icon}\n              label={label}\n              line={line}\n              allowDrop={allowDrop}\n              transition={transition}\n              expandOnClickNode={expandOnClickNode}\n              activable={activable}\n              operations={operations}\n              checkProps={checkProps}\n              disableCheck={disableCheck}\n              onClick={handleItemClick}\n              onChange={handleChange}\n            />\n          </CSSTransition>\n        ))}\n      </TransitionGroup>\n    );\n  };\n\n  const draggable = useMemo(\n    () => ({\n      props,\n      store,\n    }),\n    [props, store],\n  );\n\n  return (\n    <TreeDraggableContext.Provider value={draggable}>\n      <div\n        className={classNames(treeClassNames.tree, className, {\n          [treeClassNames.disabled]: disabled,\n          [treeClassNames.treeHoverable]: hover,\n          [treeClassNames.treeCheckable]: checkable,\n          [treeClassNames.treeFx]: transition,\n          [treeClassNames.treeBlockNode]: expandOnClickNode,\n          [treeClassNames.treeVscroll]: props.scroll, // 开启虚拟滚动就要有overflow 否则低于 threshold 无法正常运行 scrollto\n        })}\n        style={style}\n        ref={treeRef}\n      >\n        {isVirtual ? (\n          <>\n            <div className={treeClassNames.treeVscrollCursor} style={cursorStyle} />\n            {renderItems(visibleData)}\n          </>\n        ) : (\n          renderItems(visibleNodes)\n        )}\n      </div>\n    </TreeDraggableContext.Provider>\n  );\n});\n\nTree.displayName = 'Tree';\n\nexport default Tree;\n"],"names":["Tree","forwardRef","originalProps","ref","_useTreeConfig","useTreeConfig","treeClassNames","transitionNames","transitionClassNames","transitionDuration","locale","props","useDefaultProps","data","expandLevel","icon","line","transition","lazy","valueMode","_useState","useState","_useState2","_slicedToArray","visibleNodes","setVisibleNodes","empty","activable","disabled","checkable","checkProps","disableCheck","hover","label","operations","expandOnClickNode","onClick","scroll","className","style","allowDrop","onScroll","_useControllable","useControllable","value","onChange","expanded","onExpand","onActive","actived","setTreeIndeterminate","indeterminate","emptyText","store","useStore","_objectSpread","initial","nodes","getNodes","newVisibleNodes","filter","node","visible","setExpanded","usePersistFn","isExpanded","ctx","e","trigger","treeNodeModel","getModel","setIndeterminate","isIndeterminate","treeRef","useRef","_useTreeVirtualScroll","useTreeVirtualScroll","visibleData","isVirtual","virtualTreeNodeStyle","treeNodeStyle","cursorStyle","handleRowMounted","scrollToElement","setActived","isActived","setChecked","isChecked","checked","handleItemClick","options","isDisabled","expand","active","handleChange","handleScrollToElement","useCallback","params","index","key","log","error","findIndex","item","get","includes","concat","useImperativeHandle","scrollTo","p","appendTo","newData","list","Array","isArray","forEach","appendNodes","getIndex","getNodeIndex","getItem","getNode","getItems","map","getParent","getParents","getPath","pathNodes","insertAfter","insertBefore","remove","setItem","spec","prevIndeterminate","_toConsumableArray","set","nodeList","useMemo","React","createRef","renderEmpty","parseTNode","renderItems","renderNode","length","createElement","treeList","TreeItem","keys","onTreeItemMounted","TransitionGroup","name","treeNode","CSSTransition","nodeRef","timeout","classNames","draggable","TreeDraggableContext","Provider","tree","_defineProperty","treeHoverable","treeCheckable","treeFx","treeBlockNode","treeVscroll","treeVscrollCursor","displayName"],"mappings":"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"}