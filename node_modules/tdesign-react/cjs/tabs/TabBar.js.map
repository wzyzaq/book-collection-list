{"version":3,"file":"TabBar.js","sources":["../../../components/tabs/TabBar.tsx"],"sourcesContent":["import React, { useEffect, useState, CSSProperties, useRef } from 'react';\nimport classNames from 'classnames';\nimport useConfig from '../hooks/useConfig';\nimport useMutationObserver from '../hooks/useMutationObserver';\nimport useResizeObserver from '../hooks/useResizeObserver';\n\ninterface TabBarProps {\n  tabPosition: string;\n  activeId: string | number;\n  containerRef: React.MutableRefObject<HTMLDivElement>;\n  navsWrapRef: React.MutableRefObject<HTMLDivElement>;\n}\n\nconst TabBar: React.FC<TabBarProps> = (props) => {\n  const { tabPosition, activeId, containerRef, navsWrapRef } = props;\n  const { classPrefix } = useConfig();\n  const [barStyle, setBarStyle] = useState<CSSProperties>({});\n  const tabsClassPrefix = `${classPrefix}-tabs`;\n  const currentActiveIdRef = useRef(activeId);\n  useEffect(() => {\n    currentActiveIdRef.current = activeId;\n  }, [activeId]);\n\n  const computeStyle = React.useCallback(() => {\n    const isHorizontal = ['bottom', 'top'].includes(tabPosition);\n    const transformPosition = isHorizontal ? 'translateX' : 'translateY';\n    const itemProp = isHorizontal ? 'width' : 'height';\n    const barBorderProp = isHorizontal ? 'width' : 'height';\n\n    let offset = 0;\n\n    if (containerRef.current) {\n      const itemsRef = containerRef.current?.querySelectorAll<HTMLElement>(`.${tabsClassPrefix}__nav-item`);\n      if (itemsRef.length - 1 >= (currentActiveIdRef.current as number)) {\n        itemsRef.forEach((item, itemIndex) => {\n          if (itemIndex < (currentActiveIdRef.current as number)) {\n            offset += Number(getComputedStyle(item)[itemProp].replace('px', ''));\n          }\n        });\n        const computedItem = itemsRef[currentActiveIdRef.current];\n        if (!computedItem) {\n          setBarStyle({ transform: `${transformPosition}(${0}px)`, [barBorderProp]: 0 });\n          return;\n        }\n        const itemPropValue = getComputedStyle(computedItem)[itemProp];\n        setBarStyle({ transform: `${transformPosition}(${offset}px)`, [barBorderProp]: itemPropValue || 0 });\n      }\n    }\n  }, [currentActiveIdRef, containerRef, tabPosition, tabsClassPrefix]);\n\n  useEffect(() => {\n    if (containerRef.current) {\n      setTimeout(() => computeStyle());\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [tabPosition, activeId, containerRef.current]);\n\n  const handleMutationObserver = React.useCallback(\n    (mutations: MutationRecord[]) => {\n      mutations.forEach((mutation) => {\n        if (mutation.type === 'characterData') {\n          computeStyle();\n        }\n      });\n    },\n    [computeStyle],\n  );\n\n  useMutationObserver(containerRef.current, handleMutationObserver);\n\n  useResizeObserver(navsWrapRef.current, computeStyle);\n\n  return (\n    <div\n      className={classNames({\n        [`${tabsClassPrefix}__bar`]: true,\n        [`${classPrefix}-is-${tabPosition}`]: true,\n      })}\n      style={barStyle}\n    ></div>\n  );\n};\n\nTabBar.displayName = 'TabBar';\n\nexport default TabBar;\n"],"names":["TabBar","props","tabPosition","activeId","containerRef","navsWrapRef","_useConfig","useConfig","classPrefix","_useState","useState","_useState2","_slicedToArray","barStyle","setBarStyle","tabsClassPrefix","currentActiveIdRef","useRef","useEffect","current","computeStyle","React","useCallback","isHorizontal","includes","transformPosition","itemProp","barBorderProp","offset","_containerRef$current","itemsRef","querySelectorAll","concat","length","forEach","item","itemIndex","Number","getComputedStyle","replace","computedItem","_defineProperty","transform","itemPropValue","setTimeout","handleMutationObserver","mutations","mutation","type","useMutationObserver","useResizeObserver","createElement","className","classNames","style","displayName"],"mappings":"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"}